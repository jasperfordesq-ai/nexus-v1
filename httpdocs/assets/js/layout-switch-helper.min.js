!function(){"use strict";class t{constructor(){this.currentLayout=document.documentElement.getAttribute("data-layout")||"modern",this.switching=!1,this.endpoint="/api/layout-switch",this.init()}init(){document.addEventListener("click",t=>{const e=t.target.closest("[data-layout-switcher]");if(e){t.preventDefault();const n=e.dataset.layoutSwitcher;this.switchLayout(n)}}),document.addEventListener("nexus:switchLayout",t=>{this.switchLayout(t.detail.layout)}),this.cleanUrlParams(),this.ensureLayoutAttribute(),this.addTransitionGuard()}async switchLayout(t){if(!this.switching&&t!==this.currentLayout){this.switching=!0,this.showLoadingState();try{const e=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({layout:t})}),n=await e.json();n.success?(this.currentLayout=t,sessionStorage.setItem("nexus_layout_switching","true"),document.dispatchEvent(new CustomEvent("nexus:layoutChanged",{detail:{layout:t}})),setTimeout(()=>{window.location.replace(this.cleanUrl(window.location.href))},200)):(console.error("Layout switch failed:",n.message),this.showError(n.message||"Failed to switch layout"))}catch(t){console.error("Layout switch error:",t),this.showError("Failed to switch layout. Please try again.")}finally{this.switching=!1}}}cleanUrl(t){const e=new URL(t);return e.searchParams.delete("layout"),e.searchParams.delete("_refresh"),e.toString()}cleanUrlParams(){const t=new URLSearchParams(window.location.search);if(t.has("layout")||t.has("_refresh")){t.delete("layout"),t.delete("_refresh");const e=window.location.pathname+(t.toString()?"?"+t.toString():"")+window.location.hash;window.history&&window.history.replaceState&&window.history.replaceState({},"",e)}}showLoadingState(){document.body.classList.add("layout-switching");const t=document.createElement("div");t.className="layout-switch-overlay",t.innerHTML='\n                <div class="layout-switch-spinner">\n                    <div class="spinner-ring"></div>\n                    <p>Switching layout...</p>\n                </div>\n            ',document.body.appendChild(t),requestAnimationFrame(()=>{t.classList.add("visible")})}showError(t){document.body.classList.remove("layout-switching");const e=document.querySelector(".layout-switch-overlay");e&&e.remove(),window.toast&&"function"==typeof window.toast.error?window.toast.error(t):alert(t)}ensureLayoutAttribute(){document.documentElement.getAttribute("data-layout")||document.documentElement.setAttribute("data-layout","modern")}addTransitionGuard(){if(sessionStorage.getItem("nexus_layout_switching")){sessionStorage.removeItem("nexus_layout_switching"),document.body.classList.add("layout-transition-guard");const t=()=>{setTimeout(()=>{document.body.classList.add("loaded")},150)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}}getCurrentLayout(){return this.currentLayout}}const e=()=>{(()=>{const t=document.createElement("style");t.textContent="\n            .layout-switch-overlay {\n                position: fixed;\n                inset: 0;\n                background: rgba(0, 0, 0, 0.7);\n                backdrop-filter: blur(8px);\n                z-index: 99999;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                opacity: 0;\n                transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            }\n\n            .layout-switch-overlay.visible {\n                opacity: 1;\n            }\n\n            .layout-switch-spinner {\n                text-align: center;\n                color: white;\n            }\n\n            .spinner-ring {\n                width: 48px;\n                height: 48px;\n                margin: 0 auto 16px;\n                border: 3px solid rgba(255, 255, 255, 0.2);\n                border-top-color: white;\n                border-radius: 50%;\n                animation: spin 0.8s linear infinite;\n            }\n\n            @keyframes spin {\n                to { transform: rotate(360deg); }\n            }\n\n            .layout-switch-spinner p {\n                font-size: 14px;\n                font-weight: 500;\n                margin: 0;\n            }\n\n            body.layout-switching {\n                overflow: hidden;\n                pointer-events: none;\n            }\n\n            /* Smooth transition guard */\n            .layout-transition-guard {\n                opacity: 0;\n                transition: opacity 0.2s ease-out;\n            }\n\n            .layout-transition-guard.loaded {\n                opacity: 1;\n            }\n        ",document.head.appendChild(t)})(),"fetch"in window&&"Promise"in window?window.layoutSwitcher=new t:console.warn("LayoutSwitcher requires modern browser with fetch API"),(()=>{const t=document.querySelector(".modern-experimental-banner");if(!t)return;let e=!1;const n=()=>{const n=t.getBoundingClientRect(),o=document.documentElement;n.bottom<=0?o.classList.add("banner-scrolled"):o.classList.remove("banner-scrolled"),e=!1};window.addEventListener("scroll",()=>{e||(window.requestAnimationFrame(n),e=!0)},{passive:!0}),n()})()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e(),"undefined"!=typeof module&&module.exports&&(module.exports=t)}();