!function(){"use strict";class t{constructor(){this.currentLayout=document.documentElement.getAttribute("data-layout")||"modern",this.switching=!1,this.endpoint="/api/layout-switch.php",this.init()}init(){document.addEventListener("click",t=>{const n=t.target.closest("[data-layout-switcher]");if(n){t.preventDefault();const e=n.dataset.layoutSwitcher;this.switchLayout(e)}}),document.addEventListener("nexus:switchLayout",t=>{this.switchLayout(t.detail.layout)}),this.cleanUrlParams(),this.ensureLayoutAttribute(),this.addTransitionGuard()}async switchLayout(t){if(!this.switching&&t!==this.currentLayout){this.switching=!0,this.showLoadingState();try{const n=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({layout:t})}),e=await n.json();e.success?(this.currentLayout=t,document.dispatchEvent(new CustomEvent("nexus:layoutChanged",{detail:{layout:t}})),window.location.replace(this.cleanUrl(window.location.href))):(console.error("Layout switch failed:",e.message),this.showError(e.message||"Failed to switch layout"))}catch(t){console.error("Layout switch error:",t),this.showError("Failed to switch layout. Please try again.")}finally{this.switching=!1}}}cleanUrl(t){const n=new URL(t);return n.searchParams.delete("layout"),n.searchParams.delete("_refresh"),n.toString()}cleanUrlParams(){const t=new URLSearchParams(window.location.search);if(t.has("layout")||t.has("_refresh")){t.delete("layout"),t.delete("_refresh");const n=window.location.pathname+(t.toString()?"?"+t.toString():"")+window.location.hash;window.history&&window.history.replaceState&&window.history.replaceState({},"",n)}}showLoadingState(){document.body.classList.add("layout-switching");const t=document.createElement("div");t.className="layout-switch-overlay",t.innerHTML='\n                <div class="layout-switch-spinner">\n                    <div class="spinner-ring"></div>\n                    <p>Switching layout...</p>\n                </div>\n            ',document.body.appendChild(t),requestAnimationFrame(()=>{t.classList.add("visible")})}showError(t){document.body.classList.remove("layout-switching");const n=document.querySelector(".layout-switch-overlay");n&&n.remove(),window.toast&&"function"==typeof window.toast.error?window.toast.error(t):alert(t)}ensureLayoutAttribute(){document.documentElement.getAttribute("data-layout")||document.documentElement.setAttribute("data-layout","modern")}addTransitionGuard(){document.body.classList.add("layout-transition-guard");const t=()=>{setTimeout(()=>{document.body.classList.add("loaded")},50)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}getCurrentLayout(){return this.currentLayout}}const n=()=>{(()=>{const t=document.createElement("style");t.textContent="\n            .layout-switch-overlay {\n                position: fixed;\n                inset: 0;\n                background: rgba(0, 0, 0, 0.7);\n                backdrop-filter: blur(8px);\n                z-index: 99999;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                opacity: 0;\n                transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            }\n\n            .layout-switch-overlay.visible {\n                opacity: 1;\n            }\n\n            .layout-switch-spinner {\n                text-align: center;\n                color: white;\n            }\n\n            .spinner-ring {\n                width: 48px;\n                height: 48px;\n                margin: 0 auto 16px;\n                border: 3px solid rgba(255, 255, 255, 0.2);\n                border-top-color: white;\n                border-radius: 50%;\n                animation: spin 0.8s linear infinite;\n            }\n\n            @keyframes spin {\n                to { transform: rotate(360deg); }\n            }\n\n            .layout-switch-spinner p {\n                font-size: 14px;\n                font-weight: 500;\n                margin: 0;\n            }\n\n            body.layout-switching {\n                overflow: hidden;\n                pointer-events: none;\n            }\n\n            /* Smooth transition guard */\n            .layout-transition-guard {\n                opacity: 0;\n                transition: opacity 0.2s ease-out;\n            }\n\n            .layout-transition-guard.loaded {\n                opacity: 1;\n            }\n        ",document.head.appendChild(t)})(),"fetch"in window&&"Promise"in window?window.layoutSwitcher=new t:console.warn("LayoutSwitcher requires modern browser with fetch API")};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),"undefined"!=typeof module&&module.exports&&(module.exports=t)}();