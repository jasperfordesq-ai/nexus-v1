!function(){"use strict";const e=()=>window.innerWidth<=768||"ontouchstart"in window,t=()=>{navigator.vibrate&&navigator.vibrate(10),window.Capacitor?.Plugins?.Haptics&&window.Capacitor.Plugins.Haptics.impact({style:"light"})},n=()=>{navigator.vibrate&&navigator.vibrate(20),window.Capacitor?.Plugins?.Haptics&&window.Capacitor.Plugins.Haptics.impact({style:"medium"})};let o={type:null,id:null},i=!1,s=0,c=0;function a(e,t,n,o=!1){const i=e.is_liked||!1,s=parseInt(e.likes_count||e.reaction_count||0),c=e.id,m=e.replies||[],d=e.author_name||e.name||"User";let r=`\n            <div class="mobile-comment-item" data-comment-id="${c}">\n                <img src="${e.author_avatar||e.avatar_url||"/assets/img/defaults/default_avatar.webp"}" class="mobile-comment-avatar" alt="" loading="lazy">\n                <div class="mobile-comment-content">\n                    <div class="mobile-comment-author">\n                        ${l(d)}\n                        ${s>0?`<span class="mobile-comment-likes"><i class="fa-solid fa-heart"></i> ${s}</span>`:""}\n                    </div>\n                    <div class="mobile-comment-text">${l(e.content)}</div>\n                    <div class="mobile-comment-actions">\n                        <span class="mobile-comment-time">${function(e){const t=new Date(e),n=new Date,o=Math.floor((n-t)/1e3);return o<60?"Just now":o<3600?Math.floor(o/60)+"m":o<86400?Math.floor(o/3600)+"h":o<604800?Math.floor(o/86400)+"d":Math.floor(o/604800)+"w"}(e.created_at)}</span>\n                        <button type="button" class="mobile-comment-action ${i?"liked":""}" onclick="toggleMobileCommentLike(${c}, this)">\n                            <i class="fa-${i?"solid":"regular"} fa-heart"></i> Like\n                        </button>\n                        ${o?"":`<button type="button" class="mobile-comment-action" onclick="showMobileReplyForm(${c})">\n                            <i class="fa-regular fa-comment"></i> Reply\n                        </button>`}\n                    </div>\n                </div>\n            </div>\n            ${o?"":`<div class="mobile-reply-form" id="reply-form-${c}">\n                <input type="text" class="mobile-reply-input" id="reply-input-${c}" placeholder="Write a reply..." onkeydown="if(event.key === 'Enter') submitMobileReply(${c}, '${t}', ${n})">\n                <button type="button" class="mobile-reply-send" onclick="submitMobileReply(${c}, '${t}', ${n})">\n                    <i class="fa-solid fa-paper-plane"></i>\n                </button>\n            </div>`}\n        `;return m.length>0&&!o&&(r+='<div class="mobile-comment-replies">',m.forEach(e=>{r+=a(e,t,n,!0)}),r+="</div>"),r}function l(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}window.openMobileCommentSheet=function(n,i,s){if(!e())return!1;const c=document.getElementById("commentBackdrop"),a=document.getElementById("commentSheet");return!(!c||!a)&&(t(),o={type:n,id:i},loadMobileComments(n,i),c.classList.add("active"),a.classList.add("active"),document.body.classList.add("mobile-sheet-open"),document.body.style.overflow="hidden",setTimeout(()=>{document.getElementById("mobileCommentInput")?.focus()},300),!0)},window.closeMobileCommentSheet=function(){t(),document.getElementById("commentBackdrop").classList.remove("active"),document.getElementById("commentSheet").classList.remove("active"),document.body.classList.remove("mobile-sheet-open"),document.body.style.overflow="",o={type:null,id:null}},window.autoResizeCommentInput=function(e){e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"},window.loadMobileComments=function(e,t){const n=document.getElementById("mobileCommentsList");if(!n)return;n.innerHTML='<div style="text-align: center; padding: 20px; color: var(--feed-text-muted);"><i class="fa-solid fa-spinner fa-spin"></i></div>';const o=(window.BASE_URL||window.BASE_PATH||"")+"/api/social";fetch(o+"/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"fetch",target_type:e,target_id:t})}).then(e=>e.json()).then(o=>{"success"===o.status&&o.comments&&(0===o.comments.length?n.innerHTML='<div style="text-align: center; padding: 20px; color: var(--feed-text-muted);">No comments yet. Be the first!</div>':n.innerHTML=o.comments.map(n=>a(n,e,t)).join(""))}).catch(()=>{n.innerHTML='<div style="text-align: center; padding: 20px; color: #ef4444;">Failed to load comments</div>'})},window.toggleMobileCommentLike=function(e,n){t();const o=(window.BASE_URL||window.BASE_PATH||"")+"/api/social";fetch(o+"/reaction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment_id:e,emoji:"❤️"})}).then(e=>e.json()).then(e=>{if("success"===e.status||e.success){const t="added"===e.action;n.classList.toggle("liked",t),n.innerHTML=`<i class="fa-${t?"solid":"regular"} fa-heart"></i> Like`;const o=n.closest(".mobile-comment-content")?.querySelector(".mobile-comment-author");if(o){let t=o.querySelector(".mobile-comment-likes");const n=e.reactions&&e.reactions["❤️"]||0;n>0?(t||(t=document.createElement("span"),t.className="mobile-comment-likes",o.appendChild(t)),t.innerHTML=`<i class="fa-solid fa-heart"></i> ${n}`):t&&t.remove()}}}).catch(e=>{console.error("Like toggle error:",e)})},window.showMobileReplyForm=function(e){t();const n=document.getElementById(`reply-form-${e}`);n&&(n.classList.toggle("active"),n.classList.contains("active")&&document.getElementById(`reply-input-${e}`)?.focus())},window.submitMobileReply=function(e,t,i){const s=document.getElementById(`reply-input-${e}`),c=s?.value?.trim();if(!c)return;n();const a=(window.BASE_URL||window.BASE_PATH||"")+"/api/social";fetch(a+"/reply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({target_type:t,target_id:i,parent_id:e,content:c})}).then(e=>e.json()).then(t=>{"success"===t.status&&(s.value="",document.getElementById(`reply-form-${e}`)?.classList.remove("active"),loadMobileComments(o.type,o.id))})},window.submitMobileComment=function(){const e=document.getElementById("mobileCommentInput"),t=e?.value?.trim();if(!t||!o.type||!o.id)return;n();const i=(window.BASE_URL||window.BASE_PATH||"")+"/api/social",s=document.getElementById("mobileCommentSend");s&&(s.disabled=!0),fetch(i+"/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"submit",target_type:o.type,target_id:o.id,content:t})}).then(e=>e.json()).then(t=>{"success"===t.status&&(e.value="",e.style.height="auto",loadMobileComments(o.type,o.id),"function"==typeof updateCommentCount&&updateCommentCount(o.type,o.id,1))}).finally(()=>{s&&(s.disabled=!1)})},function(e,t,n){const o=document.getElementById(e),a=document.getElementById(t);o&&a&&(o.addEventListener("touchstart",function(e){i=!0,s=e.touches[0].clientY,a.classList.add("dragging")},{passive:!0}),document.addEventListener("touchmove",function(e){if(!i)return;c=e.touches[0].clientY;const t=c-s;t>0&&(a.style.transform=`translateY(${t}px)`)},{passive:!0}),document.addEventListener("touchend",function(){if(!i)return;i=!1,a.classList.remove("dragging");const e=c-s;a.style.transform="",e>100&&n(),s=0,c=0},{passive:!0}))}("commentHandle","commentSheet",closeMobileCommentSheet);let m="function"==typeof window.toggleCommentSection?window.toggleCommentSection:null;function d(t,n){if(e()){if(openMobileCommentSheet(t,n,""))return}"function"==typeof m?m(t,n):"function"==typeof window._feedDesktopToggleComment?window._feedDesktopToggleComment(t,n):"undefined"!=typeof SocialInteractions&&SocialInteractions.toggleCommentSection&&SocialInteractions.toggleCommentSection(t,n)}Object.defineProperty(window,"toggleCommentSection",{get:function(){return d},set:function(e){m=e},configurable:!0})}();