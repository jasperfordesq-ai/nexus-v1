!function(){"use strict";const e="undefined"!=typeof NEXUS_BASE?NEXUS_BASE:"";function t(){const t=document.getElementById("member-search-main");t&&t.addEventListener("input",function(){!function(t){clearTimeout(n);const r=document.querySelector(".civicone-spinner");if(0===t.length)return void(window.location.href=window.location.pathname);if(t.length<2)return;r&&r.classList.remove("civicone-spinner--hidden");n=setTimeout(function(){const n=new URL(window.location);n.searchParams.set("q",t),window.history.pushState({},"",n),function(t,n){const r=document.querySelector(".members-tabs__item--selected .members-tabs__link"),s=r&&"#active-members"===r.getAttribute("href"),a=document.querySelector(".members-tabs__panel:not(.members-tabs__panel--hidden)"),l=a?a.querySelector(".civicone-results-list"):null,d=a?a.querySelector(".civicone-empty-state"):null,u=a?a.querySelector(".moj-action-bar__filter .govuk-body"):null;if(!l)return void console.error("Results list not found");const m=new URLSearchParams;t&&m.append("q",t);s&&m.append("active","true");m.append("limit","30"),fetch(`${e}/api/members?${m.toString()}`).then(e=>{if(!e.ok)throw new Error("Search request failed");return e.json()}).then(e=>{e.data?function(e,t,n,o){const r=e.data||[],s=e.meta?.total||r.length,a=r.length;o&&(o.innerHTML=`Showing <strong>${a}</strong> of <strong>${s}</strong> members`);r.length>0?(t.innerHTML=r.map(i).join(""),n&&n.classList.add("civicone-empty-state--hidden")):(t.innerHTML="",n&&n.classList.remove("civicone-empty-state--hidden"));c(`Found ${a} members`)}(e,l,d,u):(console.error("Invalid response format:",e),o(l,"Invalid response from server"))}).catch(e=>{console.error("Search error:",e),o(l,"Unable to complete search. Please try again.")}).finally(()=>{n&&n.classList.add("civicone-spinner--hidden")})}(t,r)},300)}(t.value)})}let n=null;function i(e){const t=window.location.pathname.split("/").slice(0,-1).join("/")||"",n=e.avatar_url&&""!==e.avatar_url.trim(),i=e.last_active_at?new Date(e.last_active_at):null,o=new Date(Date.now()-3e5),c=i&&i>o,r=e.display_name||e.name||e.username||"Member",s=e.location||"";return`\n            <li class="civicone-member-item">\n                <div class="civicone-member-item__avatar">\n                    ${n?`<img src="${e.avatar_url}" alt="" class="civicone-avatar">`:'<div class="civicone-avatar civicone-avatar--placeholder">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">\n                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>\n                                <circle cx="12" cy="7" r="4"></circle>\n                            </svg>\n                        </div>'}\n                    ${c?'<span class="civicone-status-indicator civicone-status-indicator--online" title="Active now" aria-label="Currently online"></span>':""}\n                </div>\n                <div class="civicone-member-item__content">\n                    <h3 class="civicone-member-item__name">\n                        <a href="${t}/profile/${e.id}" class="civicone-link">\n                            ${r}\n                        </a>\n                    </h3>\n                    ${s?`<p class="civicone-member-item__meta">\n                        <svg class="civicone-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">\n                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>\n                            <circle cx="12" cy="10" r="3"></circle>\n                        </svg>\n                        ${s}\n                    </p>`:""}\n                </div>\n                <div class="civicone-member-item__actions">\n                    <a href="${t}/profile/${e.id}" class="civicone-button civicone-button--secondary">\n                        View profile\n                    </a>\n                </div>\n            </li>\n        `}function o(e,t){e.innerHTML=`\n            <li class="civicone-member-item" style="text-align: center; padding: 2rem;">\n                <p style="color: var(--color-error, #d4351c); margin: 0;">${t}</p>\n            </li>\n        `}function c(e){const t=document.createElement("div");t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.classList.add("govuk-visually-hidden"),t.textContent=e,document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},1e3)}function r(){!function(){const e=document.querySelectorAll("[data-filter-toggle]"),t=document.querySelectorAll("[data-filter-close]"),n=document.querySelector("[data-filter-backdrop]");e.forEach(e=>{e.addEventListener("click",function(){const t=e.getAttribute("aria-controls"),i=document.getElementById(t);if(i){const t="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",!t),i.classList.toggle("moj-filter--visible"),n&&n.setAttribute("aria-hidden",t?"true":"false");const o=e.querySelector(".members-filter-toggle__text");o&&(o.textContent=t?"Filters":"Close"),window.innerWidth<641&&document.body.classList.toggle("moj-filter--open",!t),c(t?"Filter menu closed":"Filter menu opened")}})}),t.forEach(e=>{e.addEventListener("click",function(){const t=e.closest(".moj-filter"),i=document.querySelector(`[aria-controls="${t.id}"]`);if(t&&i){t.classList.remove("moj-filter--visible"),i.setAttribute("aria-expanded","false");const e=i.querySelector(".members-filter-toggle__text");e&&(e.textContent="Filters"),n&&n.setAttribute("aria-hidden","true"),document.body.classList.remove("moj-filter--open"),c("Filter menu closed"),i.focus()}})}),document.addEventListener("keydown",function(e){if("Escape"===e.key){const e=document.querySelector(".moj-filter--visible");if(e&&window.innerWidth<641){const t=e.querySelector("[data-filter-close]");t&&t.click()}}}),n&&n.addEventListener("click",function(){const e=document.querySelector(".moj-filter--visible");if(e){const t=e.querySelector("[data-filter-close]");t&&t.click()}})}(),t(),function(){const e=document.querySelector(".members-tabs");if(!e)return;const t=e.querySelectorAll(".members-tabs__link"),n=document.querySelectorAll(".members-tabs__panel");t.forEach((e,i)=>{e.addEventListener("click",function(i){i.preventDefault();const o=e.getAttribute("href"),c=o.replace("#",""),r=new URL(window.location);r.searchParams.set("tab",c.replace("-members","")),window.history.pushState({},"",r),t.forEach(e=>{e.setAttribute("aria-selected","false"),e.setAttribute("tabindex","-1"),e.parentElement.classList.remove("members-tabs__item--selected")}),e.setAttribute("aria-selected","true"),e.removeAttribute("tabindex"),e.parentElement.classList.add("members-tabs__item--selected"),n.forEach(e=>{e.classList.add("members-tabs__panel--hidden")});const s=document.querySelector(o);s&&s.classList.remove("members-tabs__panel--hidden"),e.focus()}),e.addEventListener("keydown",function(e){let n=i;switch(e.key){case"ArrowLeft":n=i>0?i-1:t.length-1;break;case"ArrowRight":n=i<t.length-1?i+1:0;break;case"Home":n=0;break;case"End":n=t.length-1;break;default:return}e.preventDefault(),t[n].click()})})}(),document.querySelectorAll(".civicone-view-toggle").forEach(e=>{const t=e.querySelectorAll(".civicone-view-toggle__button"),n=document.querySelector(".members-tabs__panel:not(.members-tabs__panel--hidden) .civicone-results-list");n&&("grid"===(localStorage.getItem("civicone-members-view")||"list")&&(n.classList.add("civicone-results-list--grid"),t.forEach(e=>{const t="grid"===e.dataset.view;e.classList.toggle("civicone-view-toggle__button--active",t),e.setAttribute("aria-checked",t?"true":"false")})),t.forEach(e=>{e.addEventListener("click",function(){const n=e.dataset.view;t.forEach(e=>{const t=e.dataset.view===n;e.classList.toggle("civicone-view-toggle__button--active",t),e.setAttribute("aria-checked",t?"true":"false")}),document.querySelectorAll(".civicone-results-list").forEach(e=>{"grid"===n?e.classList.add("civicone-results-list--grid"):e.classList.remove("civicone-results-list--grid")}),localStorage.setItem("civicone-members-view",n),c(`Switched to ${n} view`)})}))}),console.log("CivicOne Members Directory v1.6.0 initialized (GOV.UK/MOJ compliant)")}const s=document.getElementById("member-search-main");if(s){let e;s.addEventListener("input",function(){clearTimeout(e),function(){const e=document.querySelector(".members-skeleton"),t=document.querySelector(".civicone-results-list");e&&(e.style.display="block"),t&&(t.style.opacity="0.3")}(),e=setTimeout(function(){!function(){const e=document.querySelector(".members-skeleton"),t=document.querySelector(".civicone-results-list");e&&(e.style.display="none"),t&&(t.style.opacity="1")}()},500)})}function r(){!function(){const e=document.getElementById("member-search-main"),t=document.querySelector(".members-search-bar__clear");function n(){e.value.trim().length>0?t.style.display="flex":t.style.display="none"}e&&t&&(t.addEventListener("click",function(){e.value="",e.focus(),n();const t=new Event("input",{bubbles:!0});e.dispatchEvent(t)}),e.addEventListener("input",n),n())}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r(),window.addEventListener("popstate",function(){const e=new URL(window.location).searchParams.get("tab")||"all",t=document.querySelector(`.members-tabs__link[href="#${e}-members"]`);t&&t.click()})}();