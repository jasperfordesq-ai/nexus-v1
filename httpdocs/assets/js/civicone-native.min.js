!function(){"use strict";window.CivicOneNative={config:{hapticEnabled:!0,swipeBackThreshold:100,longPressDelay:500,animationObserverThreshold:.1},init:function(){this.initProgressBar(),this.initHaptics(),this.initLongPress(),this.initRippleEffect(),this.initScrollAnimations(),this.initBottomSheet(),this.initShareButtons(),this.initFormEnhancements(),this.initTurboEvents(),this.initViewTransitions(),this.initOfflineIndicator(),console.warn("[CivicOne Native] Advanced features initialized")},progressBar:null,initProgressBar:function(){const t=document.createElement("div");t.className="civic-progress-bar",t.innerHTML='<div class="civic-progress-bar-inner"></div>',document.body.appendChild(t),this.progressBar=t.querySelector(".civic-progress-bar-inner"),document.addEventListener("turbo:visit",()=>this.startProgress()),document.addEventListener("turbo:load",()=>this.completeProgress()),window.addEventListener("beforeunload",()=>this.startProgress())},startProgress:function(){if(!this.progressBar)return;this.progressBar.style.width="0",this.progressBar.classList.add("loading");let t=0;this.progressInterval=setInterval(()=>{t+=15*Math.random(),t>90&&(t=90),this.progressBar.style.width=t+"%"},200)},completeProgress:function(){this.progressBar&&(clearInterval(this.progressInterval),this.progressBar.classList.remove("loading"),this.progressBar.style.width="100%",setTimeout(()=>{this.progressBar.style.width="0"},300))},initHaptics:function(){this.config.hapticEnabled&&"vibrate"in navigator&&(document.addEventListener("click",t=>{const e=t.target.closest(".civic-btn, .civic-bottom-nav-item, [data-haptic]");e&&this.haptic(e.dataset.haptic||"light")}),document.addEventListener("change",t=>{"checkbox"!==t.target.type&&"radio"!==t.target.type||this.haptic("light")}))},haptic:function(t="light"){if(!("vibrate"in navigator))return;const e={light:[10],medium:[20],heavy:[30],success:[10,30,10],error:[50,30,50,30,50],warning:[30,50,30],selection:[5]};navigator.vibrate(e[t]||e.light)},initSwipeNavigation:function(){if(window.innerWidth>768)return;if(!("ontouchstart"in window))return;if(window.history.length<=1)return;let t=0,e=0,i=!1;const n=document.createElement("div");n.className="civic-swipe-indicator",n.innerHTML='\n                <svg viewBox="0 0 24 24" fill="currentColor">\n                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>\n                </svg>\n            ',document.body.appendChild(n),document.addEventListener("touchstart",e=>{e.touches[0].clientX<20&&(t=e.touches[0].clientX,i=!0)},{passive:!0}),document.addEventListener("touchmove",s=>{if(!i)return;e=s.touches[0].clientX;const o=e-t;if(o>10){Math.min(o/this.config.swipeBackThreshold,1);n.classList.add("visible"),o>=this.config.swipeBackThreshold?n.classList.add("ready"):n.classList.remove("ready")}},{passive:!0}),document.addEventListener("touchend",()=>{if(!i)return;e-t>=this.config.swipeBackThreshold&&(this.haptic("medium"),window.history.back()),n.classList.remove("visible","ready"),i=!1,t=0,e=0},{passive:!0})},initLongPress:function(){let t=null,e=null;document.addEventListener("touchstart",i=>{const n=i.target.closest("[data-longpress], .civic-card");n&&(e=n,t=setTimeout(()=>{this.haptic("heavy"),n.classList.add("long-press"),n.dispatchEvent(new CustomEvent("longpress",{bubbles:!0,detail:{target:n}}));const t=n.dataset.longpressAction;"share"===t?this.shareContent(n):"menu"===t&&this.showContextMenu(n)},this.config.longPressDelay))},{passive:!0}),document.addEventListener("touchend",()=>{clearTimeout(t),e&&(e.classList.remove("long-press"),e=null)},{passive:!0}),document.addEventListener("touchmove",()=>{clearTimeout(t)},{passive:!0})},initRippleEffect:function(){document.addEventListener("click",t=>{const e=t.target.closest(".civic-btn, [data-ripple]");e&&(e.classList.remove("ripple"),e.offsetWidth,e.classList.add("ripple"),setTimeout(()=>{e.classList.remove("ripple")},600))})},initScrollAnimations:function(){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("animated"),t.unobserve(e.target))})},{threshold:this.config.animationObserverThreshold,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".civic-grid, .civic-hero-content, [data-animate]").forEach(e=>{t.observe(e)}),document.addEventListener("turbo:load",()=>{document.querySelectorAll(".civic-grid:not(.animated), .civic-hero-content:not(.animated), [data-animate]:not(.animated)").forEach(e=>{t.observe(e)})})},initBottomSheet:function(){document.addEventListener("click",t=>{const e=t.target.closest("[data-bottom-sheet]");if(e){t.preventDefault();const i=e.dataset.bottomSheet;this.showBottomSheet(i)}})},showBottomSheet:function(t){this.haptic("medium");const e=document.createElement("div");e.className="civic-bottom-sheet-backdrop",document.body.appendChild(e);const i=document.createElement("div");i.className="civic-bottom-sheet",i.setAttribute("role","dialog"),i.setAttribute("aria-modal","true");let n="";"string"==typeof t&&document.getElementById(t)?n=document.getElementById(t).innerHTML:"object"==typeof t&&(n=t.content||""),i.innerHTML=`\n                <div class="civic-bottom-sheet-handle"></div>\n                <div class="civic-bottom-sheet-content">\n                    ${n}\n                </div>\n            `,document.body.appendChild(i),requestAnimationFrame(()=>{e.classList.add("active"),i.classList.add("active")});const s=()=>{e.classList.remove("active"),i.classList.remove("active"),setTimeout(()=>{e.remove(),i.remove()},300)};e.addEventListener("click",s);let o=0,a=0;return i.addEventListener("touchstart",t=>{o=t.touches[0].clientY},{passive:!0}),i.addEventListener("touchmove",t=>{a=t.touches[0].clientY;const e=a-o;e>0&&(i.style.transform=`translateY(${e}px)`)},{passive:!0}),i.addEventListener("touchend",()=>{a-o>100?s():i.style.transform=""},{passive:!0}),{close:s}},initShareButtons:function(){document.addEventListener("click",t=>{const e=t.target.closest("[data-share]");e&&(t.preventDefault(),this.shareContent(e))})},async shareContent(t){this.haptic("medium");const e={title:t.dataset.shareTitle||document.title,text:t.dataset.shareText||"",url:t.dataset.shareUrl||window.location.href};if(navigator.share)try{return void await navigator.share(e)}catch(t){if("AbortError"===t.name)return}window.NexusNative&&NexusNative.showFallbackShare?NexusNative.showFallbackShare(e):(await navigator.clipboard.writeText(e.url),window.CivicOneMobile&&CivicOneMobile.showToast("Link copied to clipboard!","success"))},initFormEnhancements:function(){document.addEventListener("input",t=>{const e=t.target;e.matches("input, textarea, select")&&(e.classList.remove("valid","invalid","shake"),e.value&&e.checkValidity&&(e.checkValidity()?e.classList.add("valid"):e.value.length>0&&e.classList.add("invalid")))}),document.addEventListener("invalid",t=>{const e=t.target;e.classList.add("invalid","shake"),this.haptic("error"),setTimeout(()=>{e.classList.remove("shake")},500)},!0),document.addEventListener("submit",t=>{const e=t.target;e.checkValidity&&e.checkValidity()&&this.haptic("success")})},initTurboEvents:function(){document.addEventListener("turbo:load",()=>{this.initScrollAnimations(),this.haptic("selection")}),document.addEventListener("turbo:visit",()=>{document.body.classList.add("turbo-loading")}),document.addEventListener("turbo:load",()=>{document.body.classList.remove("turbo-loading")})},showContextMenu:function(t){const e=t.getBoundingClientRect(),i=document.createElement("div");i.className="civic-context-menu",i.setAttribute("role","menu"),i.innerHTML='\n                <button role="menuitem" data-action="share">\n                    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">\n                        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>\n                    </svg>\n                    Share\n                </button>\n                <button role="menuitem" data-action="copy">\n                    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">\n                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>\n                    </svg>\n                    Copy Link\n                </button>\n            ',i.style.cssText=`\n                position: fixed;\n                top: ${e.top+e.height/2}px;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                z-index: 10002;\n            `,document.body.appendChild(i),i.addEventListener("click",async e=>{const n=e.target.closest("[data-action]")?.dataset.action;if("share"===n)this.shareContent(t);else if("copy"===n){const e=t.querySelector("a")?.href||window.location.href;await navigator.clipboard.writeText(e),window.CivicOneMobile&&CivicOneMobile.showToast("Link copied!","success")}i.remove()}),setTimeout(()=>{document.addEventListener("click",function t(e){i.contains(e.target)||(i.remove(),document.removeEventListener("click",t))})},100)},initViewTransitions:function(){if(!document.startViewTransition)return void console.warn("[CivicOne Native] View Transitions API not supported");let t="forward";document.addEventListener("turbo:before-visit",e=>{t=performance.navigation&&2===performance.navigation.type?"back":"forward"}),window.addEventListener("popstate",()=>{t="back"}),document.addEventListener("turbo:before-render",e=>{"back"===t?document.documentElement.classList.add("back-nav"):document.documentElement.classList.remove("back-nav")}),document.addEventListener("turbo:load",()=>{setTimeout(()=>{document.documentElement.classList.remove("back-nav"),t="forward"},300)}),console.warn("[CivicOne Native] View Transitions enabled")},offlineIndicator:null,onlineIndicator:null,initOfflineIndicator:function(){if(window.innerWidth>768)return void console.warn("[CivicOne Native] Offline indicator disabled on desktop");this.offlineIndicator=document.createElement("div"),this.offlineIndicator.className="civic-offline-indicator",this.offlineIndicator.setAttribute("role","status"),this.offlineIndicator.setAttribute("aria-live","polite"),this.offlineIndicator.style.cssText="position:fixed;top:0;left:0;right:0;background:linear-gradient(135deg,#f59e0b,#d97706);color:white;text-align:center;padding:8px 16px;font-size:13px;font-weight:600;z-index:10000;transform:translateY(-100%);transition:transform 0.3s ease;display:flex;align-items:center;justify-content:center;gap:8px;",this.offlineIndicator.innerHTML='\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="width:16px;height:16px;flex-shrink:0;">\n                    <line x1="1" y1="1" x2="23" y2="23"></line>\n                    <path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"></path>\n                    <path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"></path>\n                    <path d="M10.71 5.05A16 16 0 0 1 22.58 9"></path>\n                    <path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"></path>\n                    <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>\n                    <line x1="12" y1="20" x2="12.01" y2="20"></line>\n                </svg>\n                <span>You\'re offline</span>\n            ',document.body.appendChild(this.offlineIndicator),this.onlineIndicator=document.createElement("div"),this.onlineIndicator.className="civic-online-indicator",this.onlineIndicator.setAttribute("role","status"),this.onlineIndicator.setAttribute("aria-live","polite"),this.onlineIndicator.style.cssText="position:fixed;top:0;left:0;right:0;background:linear-gradient(135deg,#10b981,#059669);color:white;text-align:center;padding:8px 16px;font-size:13px;font-weight:600;z-index:10000;transform:translateY(-100%);transition:transform 0.3s ease;display:flex;align-items:center;justify-content:center;gap:8px;",this.onlineIndicator.innerHTML='\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="width:16px;height:16px;flex-shrink:0;">\n                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>\n                    <polyline points="22 4 12 14.01 9 11.01"></polyline>\n                </svg>\n                <span>Back online!</span>\n            ',document.body.appendChild(this.onlineIndicator),window.addEventListener("online",()=>this.showOnlineIndicator()),window.addEventListener("offline",()=>this.showOfflineIndicator());const t=this;setTimeout(function(){navigator.onLine||t.showOfflineIndicator()},1e3)},showOfflineIndicator:function(){document.body.classList.add("is-offline"),this.offlineIndicator.classList.add("visible"),this.offlineIndicator.style.transform="translateY(0)",this.haptic("warning"),this.announceToScreenReader("You are now offline. Some features may be unavailable.")},hideOfflineIndicator:function(){document.body.classList.remove("is-offline"),this.offlineIndicator.classList.remove("visible"),this.offlineIndicator.style.transform="translateY(-100%)"},showOnlineIndicator:function(){this.hideOfflineIndicator(),this.onlineIndicator.classList.add("visible"),this.onlineIndicator.style.transform="translateY(0)",this.haptic("success"),this.announceToScreenReader("You are back online."),setTimeout(()=>{this.onlineIndicator.classList.remove("visible"),this.onlineIndicator.style.transform="translateY(-100%)"},3e3)},announceToScreenReader:function(t){let e=document.getElementById("civic-sr-announcer");e||(e=document.createElement("div"),e.id="civic-sr-announcer",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.style.cssText="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;",document.body.appendChild(e)),e.textContent="",requestAnimationFrame(()=>{e.textContent=t})}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>CivicOneNative.init()):CivicOneNative.init()}();