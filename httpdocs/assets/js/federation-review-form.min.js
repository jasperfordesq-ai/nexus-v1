document.addEventListener("DOMContentLoaded",function(){const t=document.querySelectorAll("#star-rating .star-btn"),e=document.getElementById("rating-input"),n=document.getElementById("rating-text"),s=document.getElementById("submit-btn"),a=document.getElementById("comment"),i=document.getElementById("char-count"),o=document.getElementById("char-count-text"),r=document.getElementById("review-form"),c={1:"Poor - Had significant issues",2:"Fair - Below expectations",3:"Good - Met expectations",4:"Very Good - Above expectations",5:"Excellent - Outstanding experience!"};function l(t,e=!1){t>0?(n.textContent=c[t],e&&(n.classList.remove("text-muted"),n.classList.add("text-primary","fw-bold"))):(n.textContent="Click to rate",n.classList.add("text-muted"),n.classList.remove("text-primary","fw-bold"))}function d(){const t=parseInt(e.value)>0;s.disabled=!t,s.setAttribute("aria-disabled",!t)}t.forEach(n=>{n.addEventListener("click",function(){const n=parseInt(this.dataset.rating);e.value=n,function(e){t.forEach(t=>{const n=parseInt(t.dataset.rating)<=e;t.classList.toggle("active",n),t.setAttribute("aria-checked",n?"true":"false");const s=t.querySelector("i");s.classList.toggle("fas",n),s.classList.toggle("far",!n)})}(n),l(n,!0),d(),function(t){const e=document.createElement("div");e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.className="sr-only",e.textContent=t,document.body.appendChild(e),setTimeout(()=>e.remove(),1e3)}(`${n} star${n>1?"s":""} selected. ${c[n]}`),r.style.transform="scale(1.005)",setTimeout(()=>{r.style.transform="scale(1)"},200)}),n.addEventListener("mouseenter",function(){const e=parseInt(this.dataset.rating);t.forEach(t=>{t.classList.toggle("hovered",parseInt(t.dataset.rating)<=e)}),l(e,!1)}),n.addEventListener("mouseleave",function(){t.forEach(t=>t.classList.remove("hovered"));const n=parseInt(e.value);l(n,n>0)}),n.addEventListener("keydown",function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.click());let e=parseInt(this.dataset.rating);if("ArrowRight"===t.key||"ArrowUp"===t.key?(t.preventDefault(),e=Math.min(5,e+1)):"ArrowLeft"!==t.key&&"ArrowDown"!==t.key||(t.preventDefault(),e=Math.max(1,e-1)),e!==parseInt(this.dataset.rating)){const t=document.querySelector(`.star-btn[data-rating="${e}"]`);t&&t.focus()}})}),a&&i&&(a.addEventListener("input",function(){const t=this.value.length;i.textContent=t,o.classList.remove("char-warning","char-danger"),t>1900?o.classList.add("char-danger"):t>1500&&o.classList.add("char-warning"),t%100==0&&t>0&&(o.style.transform="scale(1.1)",setTimeout(()=>{o.style.transform="scale(1)"},200))}),a.addEventListener("focus",function(){o.style.opacity="1"}),a.addEventListener("blur",function(){0===this.value.length&&(o.style.opacity="0.7")})),r&&r.addEventListener("submit",function(t){const n=parseInt(e.value);if(n<1||n>5){t.preventDefault(),alert("Please select a rating between 1 and 5 stars before submitting.");const e=document.querySelector(".star-btn");return e&&e.focus(),!1}s.disabled=!0,s.setAttribute("aria-disabled","true"),s.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Submitting...';r.querySelectorAll("input, textarea, button").forEach(t=>t.disabled=!0),r.onsubmit=function(){return!1}}),d(),"#review-form"===window.location.hash&&setTimeout(()=>{r.scrollIntoView({behavior:"smooth",block:"center"})},100);const u=document.querySelector(".review-card");u&&setTimeout(()=>{u.style.opacity="1",u.style.transform="translateY(0)"},50);const m=document.getElementById("offlineBanner");if(m){function f(){navigator.onLine?(m.classList.remove("visible"),document.body.classList.remove("is-offline"),d(),s.title=""):(m.classList.add("visible"),document.body.classList.add("is-offline"),s.disabled=!0,s.title="Cannot submit while offline")}window.addEventListener("online",f),window.addEventListener("offline",f),f()}});