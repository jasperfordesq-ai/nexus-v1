const EditOverlayConfig={isClosing:!1,basePath:window.location.pathname.split("/edit-group/")[0]||""};function haptic(e=10){navigator.vibrate&&navigator.vibrate(e)}function switchTab(e){document.querySelectorAll(".edit-pill").forEach(e=>{e.classList.remove("active"),e.setAttribute("aria-selected","false")});const t=document.querySelector(`.edit-pill[data-type="${e}"]`);t&&(t.classList.add("active"),t.setAttribute("aria-selected","true"));document.querySelectorAll(".edit-panel").forEach(e=>{e.classList.remove("active")});const n=document.getElementById(`panel-${e}`);n&&n.classList.add("active"),haptic()}function closeEditOverlay(){if(EditOverlayConfig.isClosing)return;EditOverlayConfig.isClosing=!0,haptic();const e=document.querySelector('input[name="group_id"]'),t=e?e.value:null,n=document.referrer,i=window.location.host;n&&n.includes(i)?window.location.href=n:window.location.href=t?`${EditOverlayConfig.basePath}/groups/${t}?tab=settings`:`${EditOverlayConfig.basePath}/groups`}function previewImage(e,t){if(e.files&&e.files[0]){const n=new FileReader;n.onload=function(e){const n=document.getElementById(t);n&&(n.src=e.target.result)},n.readAsDataURL(e.files[0]),haptic(20)}}document.addEventListener("DOMContentLoaded",function(){const e=window.location.pathname.split("/"),t=e.indexOf("edit-group");t>0&&(EditOverlayConfig.basePath=e.slice(0,t).join("/"));const n=document.getElementById("userSearch"),i=document.getElementById("userList"),a=document.getElementById("selectedCount"),o=document.getElementById("submitBtn"),c=document.querySelectorAll('input[name="user_ids[]"]'),s=document.getElementById("addDirectlyCheckbox");n&&i&&n.addEventListener("input",function(){const e=this.value.toLowerCase().trim();i.querySelectorAll(".user-item").forEach(t=>{(t.dataset.name||"").includes(e)?t.classList.remove("hidden"):t.classList.add("hidden")})}),c.forEach(e=>{e.addEventListener("change",function(){this.closest(".user-item").classList.toggle("selected",this.checked),function(){const e=document.querySelectorAll('input[name="user_ids[]"]:checked').length;a&&(a.textContent=`${e} member${1!==e?"s":""} selected`),o&&(o.disabled=0===e)}(),haptic()})}),s&&o&&s.addEventListener("change",function(){this.checked?(o.innerHTML='<i class="fa-solid fa-check"></i> Add Members Now',o.classList.remove("btn-invite"),o.classList.add("btn-add-direct")):(o.innerHTML='<i class="fa-solid fa-paper-plane"></i> Send Invitations',o.classList.remove("btn-add-direct"),o.classList.add("btn-invite")),haptic()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&closeEditOverlay(),"1"!==e.key||e.target.matches("input, textarea")||(e.preventDefault(),switchTab("edit")),"2"!==e.key||e.target.matches("input, textarea")||(e.preventDefault(),switchTab("invite"))});document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",function(t){if(!navigator.onLine)return t.preventDefault(),void alert("You are offline. Please connect to the internet to save changes.");const n=e.querySelector('button[type="submit"]');if(n){const t=n.innerHTML;n.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Saving...',n.disabled=!0,setTimeout(()=>{e.checkValidity()||(n.innerHTML=t,n.disabled=!1)},100)}})});document.querySelectorAll(".ed-submit, .edit-pill, .edit-close-btn, button").forEach(e=>{e.addEventListener("pointerdown",function(){this.style.transform="scale(0.96)",haptic(5)}),e.addEventListener("pointerup",function(){this.style.transform=""}),e.addEventListener("pointerleave",function(){this.style.transform=""})});document.querySelectorAll('input[type="file"]').forEach(e=>{e.addEventListener("change",function(){const e=this.parentElement.querySelector("i")||this.parentElement;this.files.length>0&&(e.classList.add("file-selected"),haptic(15))})});function d(){const e="dark"===document.documentElement.getAttribute("data-theme");let t=document.querySelector('meta[name="theme-color"]');t||(t=document.createElement("meta"),t.name="theme-color",document.head.appendChild(t)),t.setAttribute("content",e?"#1e293b":"#ffffff")}document.querySelectorAll('.ed-clear-btn input[type="checkbox"]').forEach(e=>{e.addEventListener("change",function(){if(this.checked){const e=this.closest(".ed-image-upload").querySelector(".ed-image-preview");e&&(e.style.opacity="0.3",e.style.filter="grayscale(1)"),haptic(20)}})});new MutationObserver(d).observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),d();const r=document.querySelector(".edit-overlay");if(r){const e=r.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),t=e[0],n=e[e.length-1];r.addEventListener("keydown",function(e){"Tab"===e.key&&(e.shiftKey?document.activeElement===t&&(e.preventDefault(),n.focus()):document.activeElement===n&&(e.preventDefault(),t.focus()))}),setTimeout(()=>{if(t&&"BUTTON"!==t.tagName){const e=r.querySelector('input:not([type="hidden"]), textarea');e&&e.focus()}},100)}function l(){const e=document.getElementById("offlineBanner");e&&(e.classList.add("visible"),navigator.vibrate&&navigator.vibrate(100))}window.addEventListener("online",function(){const e=document.getElementById("offlineBanner");e&&e.classList.remove("visible")}),window.addEventListener("offline",l),navigator.onLine||l()}),window.switchTab=switchTab,window.closeEditOverlay=closeEditOverlay,window.previewImage=previewImage,window.haptic=haptic;