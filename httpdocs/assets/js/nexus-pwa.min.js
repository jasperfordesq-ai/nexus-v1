!function(){"use strict";const n={vapidPublicKey:window.NEXUS_VAPID_PUBLIC_KEY||null,pushApiEndpoint:"/api/push/subscribe",pushUnsubscribeEndpoint:"/api/push/unsubscribe",installPromptDelay:3e4,installPromptMinVisits:0},e={registration:null,async register(){if(!("serviceWorker"in navigator))return console.log("[PWA] Service workers not supported"),null;try{return this.registration=await navigator.serviceWorker.register("/sw.js",{scope:"/"}),console.log("[PWA] Service worker registered:",this.registration.scope),this.registration.addEventListener("updatefound",()=>{const n=this.registration.installing;n.addEventListener("statechange",()=>{"installed"===n.state&&navigator.serviceWorker.controller&&this.showUpdatePrompt()})}),console.log("[PWA] Service worker controller change listener disabled - using update banner instead"),this.registration}catch(n){return console.error("[PWA] Service worker registration failed:",n),null}},showUpdatePrompt(){const n=document.createElement("div");n.className="nexus-pwa-update-banner",n.innerHTML='\n                <div class="nexus-pwa-update-content">\n                    <i class="fa-solid fa-arrow-rotate-right"></i>\n                    <span>A new version is available</span>\n                    <button class="nexus-pwa-update-btn">Update Now</button>\n                </div>\n            ',document.body.appendChild(n),requestAnimationFrame(()=>{n.classList.add("visible")}),n.querySelector(".nexus-pwa-update-btn").addEventListener("click",()=>{this.registration.waiting&&this.registration.waiting.postMessage({type:"SKIP_WAITING"}),n.remove(),setTimeout(()=>{window.location.reload()},500)})},async getRegistration(){return this.registration?this.registration:navigator.serviceWorker.ready}},t={isSupported:async()=>"PushManager"in window&&"Notification"in window,async getPermission(){return await this.isSupported()?Notification.permission:"unsupported"},async requestPermission(){if(!await this.isSupported())return"unsupported";const n=await Notification.requestPermission();return"granted"===n&&await this.subscribe(),n},async subscribe(){if(!n.vapidPublicKey)return console.warn("[PWA] VAPID public key not configured"),null;try{const t=await e.getRegistration();let i=await t.pushManager.getSubscription(),s=!1;i?console.log("[PWA] Found existing push subscription, re-sending to server"):(i=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(n.vapidPublicKey)}),s=!0,console.log("[PWA] Push subscription created"));return await this.sendSubscriptionToServer(i)&&console.log("[PWA] Subscription "+(s?"created and ":"")+"sent to server successfully"),i}catch(n){return console.error("[PWA] Push subscription failed:",n),null}},async unsubscribe(){try{const t=await e.getRegistration(),i=await t.pushManager.getSubscription();if(i){const e=document.querySelector('meta[name="csrf-token"]'),t=e?e.getAttribute("content"):"",s={"Content-Type":"application/json"};t&&(s["X-CSRF-Token"]=t),await fetch(n.pushUnsubscribeEndpoint,{method:"POST",headers:s,body:JSON.stringify({endpoint:i.endpoint}),credentials:"include"}),await i.unsubscribe(),console.log("[PWA] Unsubscribed from push")}return!0}catch(n){return console.error("[PWA] Unsubscribe failed:",n),!1}},async sendSubscriptionToServer(e){try{const t=document.querySelector('meta[name="csrf-token"]'),i=t?t.getAttribute("content"):"",s={"Content-Type":"application/json"};i&&(s["X-CSRF-Token"]=i);const a=await fetch(n.pushApiEndpoint,{method:"POST",headers:s,body:JSON.stringify(e),credentials:"include"});if(!a.ok){const n=await a.text();throw console.error("[PWA] Server rejected subscription:",a.status,n),new Error("Server rejected subscription")}try{await fetch("/api/notifications/settings",{method:"POST",headers:s,credentials:"include",body:JSON.stringify({push_enabled:1})})}catch(n){console.warn("[PWA] Could not update notification preferences:",n)}return console.log("[PWA] Subscription sent to server"),!0}catch(n){return console.error("[PWA] Failed to send subscription to server:",n),!1}},getSubscription:async()=>(await e.getRegistration()).pushManager.getSubscription(),urlBase64ToUint8Array(n){const e=(n+"=".repeat((4-n.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),t=window.atob(e),i=new Uint8Array(t.length);for(let n=0;n<t.length;++n)i[n]=t.charCodeAt(n);return i},showPermissionPrompt(){if("default"!==Notification.permission)return;const n=document.createElement("div");n.className="nexus-notification-prompt",n.innerHTML='\n                <div class="nexus-notification-prompt-content">\n                    <div class="nexus-notification-prompt-icon">\n                        <i class="fa-solid fa-bell"></i>\n                    </div>\n                    <div class="nexus-notification-prompt-text">\n                        <h4>Stay Updated</h4>\n                        <p>Get notified about new messages, transactions, and events</p>\n                    </div>\n                    <div class="nexus-notification-prompt-actions">\n                        <button class="nexus-prompt-btn-secondary" data-action="later">Later</button>\n                        <button class="nexus-prompt-btn-primary" data-action="enable">Enable</button>\n                    </div>\n                </div>\n            ',document.body.appendChild(n),requestAnimationFrame(()=>{n.classList.add("visible")}),n.querySelector('[data-action="enable"]').addEventListener("click",async()=>{n.classList.remove("visible"),setTimeout(()=>n.remove(),300),await this.requestPermission()}),n.querySelector('[data-action="later"]').addEventListener("click",()=>{n.classList.remove("visible"),setTimeout(()=>n.remove(),300),sessionStorage.setItem("nexus-notification-prompt-dismissed","true")})}},i={deferredPrompt:null,isInstalled:!1,isNativeApp:!1,isAndroid:/Android/i.test(navigator.userAgent),isIOS:/iPad|iPhone|iPod/.test(navigator.userAgent),init(){return"undefined"!=typeof Capacitor&&Capacitor.isNativePlatform()?(this.isNativeApp=!0,document.body.classList.add("is-native-app"),void console.log("[PWA] Running in native app - install prompts disabled")):window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone?(this.isInstalled=!0,void document.body.classList.add("is-pwa-installed")):(window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),this.deferredPrompt=n,console.log("[PWA] Install prompt captured"),this.checkAndShowPrompt()}),void window.addEventListener("appinstalled",()=>{this.isInstalled=!0,this.deferredPrompt=null,document.body.classList.add("is-pwa-installed"),console.log("[PWA] App installed successfully"),window.gtag&&gtag("event","pwa_install")}))},checkAndShowPrompt(){const e=parseInt(localStorage.getItem("nexus-visit-count")||"0");if(localStorage.setItem("nexus-visit-count",(e+1).toString()),e<n.installPromptMinVisits)return;const t=localStorage.getItem("nexus-install-dismissed");if(t){const n=parseInt(t);if((Date.now()-n)/864e5<7)return}setTimeout(()=>this.showPrompt(),n.installPromptDelay)},showPrompt(){if(this.isNativeApp||this.isInstalled)return;if(!this.isAndroid&&!this.isIOS&&!this.deferredPrompt)return;const n=document.createElement("div");n.className="nexus-install-prompt",this.isAndroid?n.innerHTML='\n                    <div class="nexus-install-prompt-card nexus-install-android">\n                        <button class="nexus-install-close" aria-label="Close">\n                            <i class="fa-solid fa-xmark"></i>\n                        </button>\n                        <div class="nexus-install-icon">\n                            <img src="/assets/images/pwa/icon-192x192.png" alt="NEXUS" width="64" height="64">\n                        </div>\n                        <h3 class="nexus-install-title">Install NEXUS</h3>\n                        <p class="nexus-install-description">Two ways to get the app on your device</p>\n\n                        \x3c!-- Option 1: Native APK --\x3e\n                        <div class="nexus-install-section nexus-install-section-apk">\n                            <div class="nexus-install-section-header">\n                                <i class="fa-brands fa-android"></i>\n                                <span>Android App (APK)</span>\n                                <span class="nexus-install-section-tag nexus-install-section-tag-green">Android Only</span>\n                            </div>\n                            <div class="nexus-install-section-body">\n                                <ul class="nexus-install-benefits">\n                                    <li><i class="fa-solid fa-check"></i> Native Android experience</li>\n                                    <li><i class="fa-solid fa-check"></i> Works offline</li>\n                                </ul>\n                                <div class="nexus-install-apk-note">\n                                    <i class="fa-solid fa-info-circle"></i>\n                                    <span>Not from Play Store - you\'ll need to allow installation from this source</span>\n                                </div>\n                                <a href="/mobile-download" class="nexus-install-section-btn nexus-install-section-btn-green">\n                                    <i class="fa-solid fa-download"></i> Download APK\n                                </a>\n                            </div>\n                        </div>\n\n                        \x3c!-- Divider --\x3e\n                        <div class="nexus-install-divider"><span>or</span></div>\n\n                        \x3c!-- Option 2: PWA --\x3e\n                        <div class="nexus-install-section">\n                            <div class="nexus-install-section-header">\n                                <i class="fa-solid fa-globe"></i>\n                                <span>Web App (PWA)</span>\n                            </div>\n                            <div class="nexus-install-section-body">\n                                <ul class="nexus-install-benefits">\n                                    <li><i class="fa-solid fa-check"></i> Works on Android, iPhone & Desktop</li>\n                                    <li><i class="fa-solid fa-check"></i> No download required</li>\n                                    <li><i class="fa-solid fa-check"></i> Always up to date</li>\n                                </ul>\n                                <button class="nexus-install-section-btn" data-action="install">\n                                    <i class="fa-solid fa-plus"></i> Add to Home Screen\n                                </button>\n                            </div>\n                        </div>\n\n                        <button class="nexus-install-btn-text" data-action="later">Maybe Later</button>\n                    </div>\n                ':this.isIOS?n.innerHTML='\n                    <div class="nexus-install-prompt-card">\n                        <button class="nexus-install-close" aria-label="Close">\n                            <i class="fa-solid fa-xmark"></i>\n                        </button>\n                        <div class="nexus-install-icon">\n                            <img src="/assets/images/pwa/icon-192x192.png" alt="NEXUS" width="64" height="64">\n                        </div>\n                        <h3 class="nexus-install-title">Install NEXUS on iPhone</h3>\n                        <p class="nexus-install-description">Add to your home screen for an app-like experience</p>\n\n                        <ul class="nexus-install-benefits" style="margin-bottom: 16px;">\n                            <li><i class="fa-solid fa-check"></i> Works just like a native app</li>\n                            <li><i class="fa-solid fa-check"></i> Full screen experience</li>\n                            <li><i class="fa-solid fa-check"></i> Quick access from home screen</li>\n                        </ul>\n\n                        <div class="nexus-install-ios-steps">\n                            <div class="nexus-install-ios-step">\n                                <span class="nexus-install-ios-step-num">1</span>\n                                <span>Tap <i class="fa-solid fa-arrow-up-from-bracket" style="color: #007AFF;"></i> at the bottom of Safari</span>\n                            </div>\n                            <div class="nexus-install-ios-step">\n                                <span class="nexus-install-ios-step-num">2</span>\n                                <span>Scroll down and tap <strong>Add to Home Screen</strong></span>\n                            </div>\n                            <div class="nexus-install-ios-step">\n                                <span class="nexus-install-ios-step-num">3</span>\n                                <span>Tap <strong>Add</strong> in the top right corner</span>\n                            </div>\n                        </div>\n\n                        <div class="nexus-install-actions">\n                            <button class="nexus-install-btn-secondary" data-action="later" style="flex: 1;">Got it</button>\n                        </div>\n                    </div>\n                ':n.innerHTML='\n                    <div class="nexus-install-prompt-card">\n                        <button class="nexus-install-close" aria-label="Close">\n                            <i class="fa-solid fa-xmark"></i>\n                        </button>\n                        <div class="nexus-install-icon">\n                            <img src="/assets/images/pwa/icon-192x192.png" alt="NEXUS" width="64" height="64">\n                        </div>\n                        <h3 class="nexus-install-title">Install NEXUS</h3>\n                        <p class="nexus-install-description">\n                            Add to your desktop for quick access\n                        </p>\n                        <div class="nexus-install-features">\n                            <div class="nexus-install-feature">\n                                <i class="fa-solid fa-bolt"></i>\n                                <span>Faster</span>\n                            </div>\n                            <div class="nexus-install-feature">\n                                <i class="fa-solid fa-bell"></i>\n                                <span>Notifications</span>\n                            </div>\n                            <div class="nexus-install-feature">\n                                <i class="fa-solid fa-wifi-slash"></i>\n                                <span>Offline</span>\n                            </div>\n                        </div>\n                        <div class="nexus-install-actions">\n                            <button class="nexus-install-btn-secondary" data-action="later">Not Now</button>\n                            <button class="nexus-install-btn-primary" data-action="install">\n                                <i class="fa-solid fa-download"></i>\n                                Install\n                            </button>\n                        </div>\n                    </div>\n                ',document.body.appendChild(n),requestAnimationFrame(()=>{n.classList.add("visible")});const e=()=>{n.classList.remove("visible"),setTimeout(()=>n.remove(),300),localStorage.setItem("nexus-install-dismissed",Date.now().toString())},t=n.querySelector('[data-action="install"]');t&&t.addEventListener("click",async()=>{this.deferredPrompt&&await this.install(),n.classList.remove("visible"),setTimeout(()=>n.remove(),300)});const i=n.querySelector('[data-action="later"]');i&&i.addEventListener("click",e);const s=n.querySelector(".nexus-install-close");s&&s.addEventListener("click",e)},async install(){if(!this.deferredPrompt)return!1;this.deferredPrompt.prompt();const{outcome:n}=await this.deferredPrompt.userChoice;return console.log("[PWA] Install prompt outcome:",n),this.deferredPrompt=null,"accepted"===n},canInstall(){return!!this.deferredPrompt&&!this.isInstalled}},s={async isSupported(){if(!window.PublicKeyCredential)return!1;try{return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}catch(n){return!1}},async register(n,e,t){if(!await this.isSupported())throw new Error("Biometric authentication not supported");try{const e=await fetch("/api/webauthn/register-challenge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n}),credentials:"include"});if(!e.ok)throw new Error("Failed to get registration challenge");const t=await e.json();t.challenge=this.base64ToArrayBuffer(t.challenge),t.user.id=this.base64ToArrayBuffer(t.user.id),t.excludeCredentials&&(t.excludeCredentials=t.excludeCredentials.map(n=>({...n,id:this.base64ToArrayBuffer(n.id)})));const i=await navigator.credentials.create({publicKey:t});if(!(await fetch("/api/webauthn/register-verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:i.id,rawId:this.arrayBufferToBase64(i.rawId),type:i.type,response:{clientDataJSON:this.arrayBufferToBase64(i.response.clientDataJSON),attestationObject:this.arrayBufferToBase64(i.response.attestationObject)}}),credentials:"include"})).ok)throw new Error("Failed to verify registration");return console.log("[WebAuthn] Biometric registered successfully"),!0}catch(n){throw console.error("[WebAuthn] Registration failed:",n),n}},async authenticate(){if(!await this.isSupported())throw new Error("Biometric authentication not supported");try{const n=await fetch("/api/webauthn/auth-challenge",{method:"POST",credentials:"include"});if(!n.ok)throw new Error("Failed to get authentication challenge");const e=await n.json();e.challenge=this.base64ToArrayBuffer(e.challenge),e.allowCredentials&&(e.allowCredentials=e.allowCredentials.map(n=>({...n,id:this.base64ToArrayBuffer(n.id)})));const t=await navigator.credentials.get({publicKey:e}),i=await fetch("/api/webauthn/auth-verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id,rawId:this.arrayBufferToBase64(t.rawId),type:t.type,response:{clientDataJSON:this.arrayBufferToBase64(t.response.clientDataJSON),authenticatorData:this.arrayBufferToBase64(t.response.authenticatorData),signature:this.arrayBufferToBase64(t.response.signature),userHandle:t.response.userHandle?this.arrayBufferToBase64(t.response.userHandle):null}}),credentials:"include"});if(!i.ok)throw new Error("Authentication failed");const s=await i.json();return console.log("[WebAuthn] Biometric authentication successful"),s}catch(n){throw"NotAllowedError"===n.name?console.log("[WebAuthn] User cancelled authentication"):console.error("[WebAuthn] Authentication failed:",n),n}},base64ToArrayBuffer(n){const e=window.atob(n.replace(/-/g,"+").replace(/_/g,"/")),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer},arrayBufferToBase64(n){const e=new Uint8Array(n);let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return window.btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},showSetupPrompt(){const n=document.createElement("div");return n.className="nexus-biometric-prompt",n.innerHTML='\n                <div class="nexus-biometric-card">\n                    <div class="nexus-biometric-icon">\n                        <i class="fa-solid fa-fingerprint"></i>\n                    </div>\n                    <h3>Enable Quick Login</h3>\n                    <p>Use Face ID, Touch ID, or fingerprint to sign in quickly and securely</p>\n                    <div class="nexus-biometric-actions">\n                        <button class="nexus-biometric-btn-secondary" data-action="later">Maybe Later</button>\n                        <button class="nexus-biometric-btn-primary" data-action="enable">Enable</button>\n                    </div>\n                </div>\n            ',document.body.appendChild(n),requestAnimationFrame(()=>{n.classList.add("visible")}),new Promise(e=>{n.querySelector('[data-action="enable"]').addEventListener("click",async()=>{n.classList.remove("visible"),setTimeout(()=>n.remove(),300),e(!0)}),n.querySelector('[data-action="later"]').addEventListener("click",()=>{n.classList.remove("visible"),setTimeout(()=>n.remove(),300),localStorage.setItem("nexus-biometric-dismissed",Date.now().toString()),e(!1)})})}};async function a(){if(function(){const n=document.createElement("style");n.textContent='\n            /* PWA Update Banner */\n            .nexus-pwa-update-banner {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                background: linear-gradient(135deg, #6366f1, #8b5cf6);\n                color: white;\n                z-index: 100001;\n                transform: translateY(-100%);\n                transition: transform 0.3s ease;\n            }\n\n            .nexus-pwa-update-banner.visible {\n                transform: translateY(0);\n            }\n\n            .nexus-pwa-update-content {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 12px;\n                padding: 12px 20px;\n                max-width: 600px;\n                margin: 0 auto;\n            }\n\n            .nexus-pwa-update-btn {\n                background: white;\n                color: #6366f1;\n                border: none;\n                padding: 8px 16px;\n                border-radius: 8px;\n                font-weight: 600;\n                cursor: pointer;\n            }\n\n            /* Notification Permission Prompt */\n            .nexus-notification-prompt {\n                position: fixed;\n                bottom: 100px;\n                left: 16px;\n                right: 16px;\n                z-index: 99999;\n                opacity: 0;\n                transform: translateY(20px);\n                transition: all 0.3s ease;\n            }\n\n            .nexus-notification-prompt.visible {\n                opacity: 1;\n                transform: translateY(0);\n            }\n\n            .nexus-notification-prompt-content {\n                background: var(--drawer-bg, white);\n                border-radius: 16px;\n                padding: 20px;\n                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);\n                display: flex;\n                flex-wrap: wrap;\n                align-items: center;\n                gap: 16px;\n                max-width: 400px;\n                margin: 0 auto;\n            }\n\n            .nexus-notification-prompt-icon {\n                width: 48px;\n                height: 48px;\n                background: linear-gradient(135deg, #f59e0b, #f97316);\n                border-radius: 12px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                font-size: 1.5rem;\n            }\n\n            .nexus-notification-prompt-text {\n                flex: 1;\n                min-width: 150px;\n            }\n\n            .nexus-notification-prompt-text h4 {\n                margin: 0 0 4px;\n                font-size: 1rem;\n            }\n\n            .nexus-notification-prompt-text p {\n                margin: 0;\n                font-size: 0.85rem;\n                opacity: 0.8;\n            }\n\n            .nexus-notification-prompt-actions {\n                display: flex;\n                gap: 8px;\n                width: 100%;\n            }\n\n            .nexus-prompt-btn-secondary,\n            .nexus-prompt-btn-primary {\n                flex: 1;\n                padding: 10px 16px;\n                border-radius: 10px;\n                font-weight: 600;\n                cursor: pointer;\n                border: none;\n            }\n\n            .nexus-prompt-btn-secondary {\n                background: rgba(0, 0, 0, 0.05);\n                color: inherit;\n            }\n\n            .nexus-prompt-btn-primary {\n                background: linear-gradient(135deg, #6366f1, #8b5cf6);\n                color: white;\n            }\n\n            /* Install Prompt */\n            .nexus-install-prompt {\n                position: fixed;\n                inset: 0;\n                background: rgba(0, 0, 0, 0.5);\n                z-index: 100000;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                padding: 20px;\n                opacity: 0;\n                visibility: hidden;\n                transition: all 0.3s ease;\n            }\n\n            .nexus-install-prompt.visible {\n                opacity: 1;\n                visibility: visible;\n            }\n\n            .nexus-install-prompt-card {\n                background: var(--drawer-bg, white);\n                border-radius: 24px;\n                padding: 32px 24px;\n                max-width: 340px;\n                width: 100%;\n                text-align: center;\n                position: relative;\n                transform: scale(0.9);\n                transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n            }\n\n            .nexus-install-prompt.visible .nexus-install-prompt-card {\n                transform: scale(1);\n            }\n\n            .nexus-install-close {\n                position: absolute;\n                top: 16px;\n                right: 16px;\n                width: 32px;\n                height: 32px;\n                background: rgba(0, 0, 0, 0.05);\n                border: none;\n                border-radius: 50%;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .nexus-install-icon {\n                margin-bottom: 16px;\n            }\n\n            .nexus-install-icon img {\n                width: 72px;\n                height: 72px;\n                border-radius: 16px;\n                box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);\n            }\n\n            .nexus-install-title {\n                margin: 0 0 8px;\n                font-size: 1.5rem;\n            }\n\n            .nexus-install-description {\n                margin: 0 0 20px;\n                font-size: 0.95rem;\n                opacity: 0.8;\n            }\n\n            .nexus-install-features {\n                display: flex;\n                justify-content: center;\n                gap: 16px;\n                margin-bottom: 24px;\n                flex-wrap: wrap;\n            }\n\n            .nexus-install-feature {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 6px;\n                font-size: 0.75rem;\n                opacity: 0.8;\n            }\n\n            .nexus-install-feature i {\n                width: 36px;\n                height: 36px;\n                background: rgba(99, 102, 241, 0.1);\n                border-radius: 10px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: #6366f1;\n                font-size: 1rem;\n            }\n\n            .nexus-install-actions {\n                display: flex;\n                gap: 12px;\n            }\n\n            .nexus-install-btn-secondary,\n            .nexus-install-btn-primary {\n                flex: 1;\n                padding: 14px 20px;\n                border-radius: 12px;\n                font-weight: 600;\n                cursor: pointer;\n                border: none;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 8px;\n            }\n\n            .nexus-install-btn-secondary {\n                background: rgba(0, 0, 0, 0.05);\n                color: inherit;\n            }\n\n            .nexus-install-btn-primary {\n                background: linear-gradient(135deg, #6366f1, #8b5cf6);\n                color: white;\n            }\n\n            /* Android Install Options */\n            .nexus-install-option {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                padding: 14px;\n                background: rgba(0, 0, 0, 0.03);\n                border-radius: 12px;\n                margin-bottom: 10px;\n                position: relative;\n                text-align: left;\n            }\n\n            .nexus-install-option-badge {\n                position: absolute;\n                top: -8px;\n                left: 12px;\n                background: #6366f1;\n                color: white;\n                font-size: 0.65rem;\n                font-weight: 700;\n                padding: 3px 8px;\n                border-radius: 6px;\n                text-transform: uppercase;\n                letter-spacing: 0.5px;\n            }\n\n            .nexus-install-option-icon {\n                width: 44px;\n                height: 44px;\n                background: rgba(99, 102, 241, 0.1);\n                border-radius: 10px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: #6366f1;\n                font-size: 1.25rem;\n                flex-shrink: 0;\n            }\n\n            .nexus-install-option-info {\n                flex: 1;\n                min-width: 0;\n            }\n\n            .nexus-install-option-info strong {\n                display: block;\n                font-size: 0.95rem;\n                margin-bottom: 2px;\n            }\n\n            .nexus-install-option-info span {\n                font-size: 0.75rem;\n                opacity: 0.7;\n            }\n\n            .nexus-install-option-btn {\n                padding: 10px 16px;\n                background: #6366f1;\n                color: white;\n                border: none;\n                border-radius: 8px;\n                font-weight: 600;\n                font-size: 0.85rem;\n                cursor: pointer;\n                text-decoration: none;\n                flex-shrink: 0;\n            }\n\n            .nexus-install-option-btn-green {\n                background: #10b981;\n            }\n\n            .nexus-install-btn-text {\n                background: none;\n                border: none;\n                color: inherit;\n                opacity: 0.6;\n                font-size: 0.85rem;\n                cursor: pointer;\n                padding: 12px;\n                width: 100%;\n                margin-top: 4px;\n            }\n\n            .nexus-install-btn-text:hover {\n                opacity: 1;\n            }\n\n            /* iOS Install Steps */\n            .nexus-install-ios-steps {\n                text-align: left;\n                margin-bottom: 16px;\n            }\n\n            .nexus-install-ios-step {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                padding: 12px 0;\n                border-bottom: 1px solid rgba(0, 0, 0, 0.06);\n                font-size: 0.9rem;\n            }\n\n            .nexus-install-ios-step:last-child {\n                border-bottom: none;\n            }\n\n            .nexus-install-ios-step-num {\n                width: 28px;\n                height: 28px;\n                background: linear-gradient(135deg, #6366f1, #8b5cf6);\n                color: white;\n                border-radius: 50%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-weight: 700;\n                font-size: 0.8rem;\n                flex-shrink: 0;\n            }\n\n            .nexus-install-ios-step i {\n                color: #6366f1;\n            }\n\n            /* Benefits list */\n            .nexus-install-benefits {\n                list-style: none;\n                padding: 0;\n                margin: 0 0 12px 0;\n                text-align: left;\n            }\n\n            .nexus-install-benefits li {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 6px 0;\n                font-size: 0.85rem;\n            }\n\n            .nexus-install-benefits li i {\n                color: #10b981;\n                font-size: 0.75rem;\n                width: 16px;\n                flex-shrink: 0;\n            }\n\n            /* Install Sections (new design) */\n            .nexus-install-section {\n                background: rgba(0, 0, 0, 0.02);\n                border: 1px solid rgba(0, 0, 0, 0.06);\n                border-radius: 12px;\n                overflow: hidden;\n                text-align: left;\n            }\n\n            .nexus-install-section-header {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 12px 14px;\n                background: rgba(99, 102, 241, 0.08);\n                font-weight: 600;\n                font-size: 0.9rem;\n            }\n\n            .nexus-install-section-header i {\n                color: #6366f1;\n            }\n\n            .nexus-install-section-apk .nexus-install-section-header {\n                background: rgba(16, 185, 129, 0.08);\n            }\n\n            .nexus-install-section-apk .nexus-install-section-header i {\n                color: #10b981;\n            }\n\n            .nexus-install-section-tag {\n                margin-left: auto;\n                font-size: 0.65rem;\n                font-weight: 700;\n                text-transform: uppercase;\n                letter-spacing: 0.5px;\n                padding: 3px 8px;\n                border-radius: 4px;\n                background: #6366f1;\n                color: white;\n            }\n\n            .nexus-install-section-tag-green {\n                background: #10b981;\n            }\n\n            .nexus-install-section-body {\n                padding: 14px;\n            }\n\n            .nexus-install-section-btn {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 8px;\n                width: 100%;\n                padding: 12px 16px;\n                background: #6366f1;\n                color: white;\n                border: none;\n                border-radius: 8px;\n                font-weight: 600;\n                font-size: 0.9rem;\n                cursor: pointer;\n                text-decoration: none;\n            }\n\n            .nexus-install-section-btn-green {\n                background: #10b981;\n            }\n\n            .nexus-install-apk-note {\n                display: flex;\n                align-items: flex-start;\n                gap: 8px;\n                padding: 10px 12px;\n                background: rgba(245, 158, 11, 0.1);\n                border-radius: 8px;\n                font-size: 0.75rem;\n                color: #b45309;\n                margin-bottom: 12px;\n            }\n\n            .nexus-install-apk-note i {\n                flex-shrink: 0;\n                margin-top: 2px;\n            }\n\n            .nexus-install-divider {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                margin: 16px 0;\n                opacity: 0.5;\n                font-size: 0.8rem;\n            }\n\n            .nexus-install-divider::before,\n            .nexus-install-divider::after {\n                content: \'\';\n                flex: 1;\n                height: 1px;\n                background: currentColor;\n                opacity: 0.3;\n            }\n\n            /* Dark mode */\n            [data-theme="dark"] .nexus-install-option {\n                background: rgba(255, 255, 255, 0.05);\n            }\n\n            [data-theme="dark"] .nexus-install-ios-step {\n                border-bottom-color: rgba(255, 255, 255, 0.1);\n            }\n\n            [data-theme="dark"] .nexus-install-section {\n                background: rgba(255, 255, 255, 0.03);\n                border-color: rgba(255, 255, 255, 0.08);\n            }\n\n            [data-theme="dark"] .nexus-install-section-header {\n                background: rgba(99, 102, 241, 0.15);\n            }\n\n            [data-theme="dark"] .nexus-install-section-apk .nexus-install-section-header {\n                background: rgba(16, 185, 129, 0.15);\n            }\n\n            [data-theme="dark"] .nexus-install-apk-note {\n                background: rgba(245, 158, 11, 0.15);\n                color: #fbbf24;\n            }\n\n            /* Biometric Prompt */\n            .nexus-biometric-prompt {\n                position: fixed;\n                inset: 0;\n                background: rgba(0, 0, 0, 0.5);\n                z-index: 100000;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                padding: 20px;\n                opacity: 0;\n                visibility: hidden;\n                transition: all 0.3s ease;\n            }\n\n            .nexus-biometric-prompt.visible {\n                opacity: 1;\n                visibility: visible;\n            }\n\n            .nexus-biometric-card {\n                background: var(--drawer-bg, white);\n                border-radius: 24px;\n                padding: 32px 24px;\n                max-width: 320px;\n                width: 100%;\n                text-align: center;\n            }\n\n            .nexus-biometric-icon {\n                width: 80px;\n                height: 80px;\n                background: linear-gradient(135deg, #6366f1, #8b5cf6);\n                border-radius: 20px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                margin: 0 auto 20px;\n                font-size: 2.5rem;\n                color: white;\n            }\n\n            .nexus-biometric-card h3 {\n                margin: 0 0 8px;\n                font-size: 1.3rem;\n            }\n\n            .nexus-biometric-card p {\n                margin: 0 0 24px;\n                font-size: 0.9rem;\n                opacity: 0.8;\n            }\n\n            .nexus-biometric-actions {\n                display: flex;\n                gap: 12px;\n            }\n\n            .nexus-biometric-btn-secondary,\n            .nexus-biometric-btn-primary {\n                flex: 1;\n                padding: 14px 20px;\n                border-radius: 12px;\n                font-weight: 600;\n                cursor: pointer;\n                border: none;\n            }\n\n            .nexus-biometric-btn-secondary {\n                background: rgba(0, 0, 0, 0.05);\n                color: inherit;\n            }\n\n            .nexus-biometric-btn-primary {\n                background: linear-gradient(135deg, #6366f1, #8b5cf6);\n                color: white;\n            }\n\n            /* Dark mode adjustments */\n            [data-theme="dark"] .nexus-prompt-btn-secondary,\n            [data-theme="dark"] .nexus-install-btn-secondary,\n            [data-theme="dark"] .nexus-biometric-btn-secondary,\n            [data-theme="dark"] .nexus-install-close {\n                background: rgba(255, 255, 255, 0.1);\n            }\n        ',document.head.appendChild(n)}(),await e.register(),i.init(),document.body.classList.contains("logged-in")&&"granted"===Notification.permission&&n.vapidPublicKey)try{const n=await e.getRegistration();if(n){const e=await n.pushManager.getSubscription();e?(console.log("[PWA] Permission granted, ensuring subscription is saved..."),await t.sendSubscriptionToServer(e)):(console.log("[PWA] Permission granted but no subscription, subscribing..."),await t.subscribe())}}catch(n){console.warn("[PWA] Auto-subscribe check failed:",n)}document.body.classList.contains("logged-in")&&"default"===Notification.permission&&!sessionStorage.getItem("nexus-notification-prompt-dismissed")&&setTimeout(()=>{t.showPermissionPrompt()},5e3),console.log("[PWA] Features initialized")}window.NexusPWA={ServiceWorker:e,Push:t,Install:i,Biometric:s,init:a},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a()}();