!function(){"use strict";const e="undefined"!=typeof NEXUS_BASE?NEXUS_BASE:"";if(!("undefined"!=typeof Capacitor&&Capacitor.isNativePlatform&&Capacitor.isNativePlatform()))return void console.log("[NativeFeatures] Not in native app, skipping native features");console.log("[NativeFeatures] Initializing native features");const t={Badge:null,async init(){try{if(this.Badge=Capacitor.Plugins.Badge,!this.Badge)return void console.log("[Badge] Badge plugin not available");const{isSupported:e}=await this.Badge.isSupported();if(!e)return void console.log("[Badge] Badge not supported on this device");await this.Badge.requestPermissions(),this.updateBadgeFromServer(),this.setupListeners(),console.log("[Badge] Badge manager initialized")}catch(e){console.error("[Badge] Init error:",e)}},setupListeners(){document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&this.updateBadgeFromServer()}),window.addEventListener("nexus:badge-update",e=>{this.set(e.detail.count)}),setInterval(()=>this.updateBadgeFromServer(),6e4)},async updateBadgeFromServer(){try{const t=await fetch(e+"/api/notifications/unread-count",{credentials:"include"});if(t.ok){const e=await t.json();this.set(e.count||0)}}catch(e){console.error("[Badge] Failed to fetch unread count:",e)}},async set(e){if(this.Badge)try{e>0?(await this.Badge.set({count:e}),console.log("[Badge] Set to:",e)):(await this.Badge.clear(),console.log("[Badge] Cleared"))}catch(e){console.error("[Badge] Set error:",e)}},async clear(){if(this.Badge)try{await this.Badge.clear(),console.log("[Badge] Cleared")}catch(e){console.error("[Badge] Clear error:",e)}},async increase(e=1){if(this.Badge)try{await this.Badge.increase({count:e})}catch(e){console.error("[Badge] Increase error:",e)}},async decrease(e=1){if(this.Badge)try{await this.Badge.decrease({count:e})}catch(e){console.error("[Badge] Decrease error:",e)}}},a={App:null,async init(){try{if(this.App=Capacitor.Plugins.App,!this.App)return void console.log("[DeepLink] App plugin not available");this.App.addListener("appUrlOpen",e=>{console.log("[DeepLink] App URL opened:",e.url),this.handleDeepLink(e.url)}),this.App.addListener("appStateChange",e=>{console.log("[DeepLink] App state:",e.isActive?"active":"background"),e.isActive&&t.updateBadgeFromServer()}),this.App.addListener("backButton",e=>{console.log("[DeepLink] Back button pressed, can go back:",e.canGoBack),e.canGoBack?window.history.back():this.showExitConfirmation()}),console.log("[DeepLink] Deep link manager initialized")}catch(e){console.error("[DeepLink] Init error:",e)}},handleDeepLink(e){try{const t=new URL(e);if("hour-timebank.ie"!==t.hostname&&"www.hour-timebank.ie"!==t.hostname)return void console.log("[DeepLink] External URL, not handling:",e);const a=t.pathname+t.search+t.hash;a&&"/"!==a&&(console.log("[DeepLink] Navigating to:",a),window.location.href=a)}catch(e){console.error("[DeepLink] Handle error:",e)}},showExitConfirmation(){confirm("Exit the app?")&&this.App.exitApp()}},i={async init(){const e=new URL(window.location.href),t=e.searchParams.get("shared_title"),a=e.searchParams.get("shared_text"),i=e.searchParams.get("shared_url");(t||a||i)&&(console.log("[ShareTarget] Received shared content:",{sharedTitle:t,sharedText:a,sharedUrl:i}),sessionStorage.setItem("nexus_shared_content",JSON.stringify({title:t,text:a,url:i})),window.location.pathname.includes("/create")||window.location.pathname.includes("/post")||(window.location.href="/create?shared=1"))}};async function n(){await t.init(),await a.init(),await i.init()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),window.NexusBadge=t,window.NexusDeepLink=a}();