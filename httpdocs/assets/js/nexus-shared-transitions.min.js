!function(){"use strict";const t="startViewTransition"in document;class e{constructor(){this.isTransitioning=!1,this.transitionData=null,this.navigationHistory=[],t?this.init():(console.log("[NEXUS] View Transitions not supported, using fallback"),this.initFallback())}init(){this.navigationHistory.push(window.location.href),document.addEventListener("click",t=>this.handleClick(t)),window.addEventListener("popstate",t=>this.handlePopState(t)),this.assignTransitionNames(),console.log("[NEXUS] Shared transitions initialized")}initFallback(){document.addEventListener("click",t=>{const e=t.target.closest("a");e&&this.shouldTransition(e)&&document.body.classList.add("page-transitioning")})}assignTransitionNames(){document.querySelectorAll(".listing-card, [data-listing-id]").forEach((t,e)=>{const i=t.dataset.listingId||e;t.style.viewTransitionName=`listing-${i}`;const n=t.querySelector("img, .card-image, .listing-image");n&&(n.style.viewTransitionName=`listing-image-${i}`)}),document.querySelectorAll(".member-card, [data-member-id]").forEach((t,e)=>{const i=t.dataset.memberId||e;t.style.viewTransitionName=`member-${i}`;const n=t.querySelector(".avatar, img");n&&(n.style.viewTransitionName=`member-avatar-${i}`)}),document.querySelectorAll(".event-card, [data-event-id]").forEach((t,e)=>{const i=t.dataset.eventId||e;t.style.viewTransitionName=`event-${i}`})}handleClick(t){const e=t.target.closest("a");if(!e||!this.shouldTransition(e))return;const i=t.target.closest('[style*="view-transition-name"]');if(i){const t=i.style.viewTransitionName;sessionStorage.setItem("nexus-transition-source",t);const e=i.getBoundingClientRect();sessionStorage.setItem("nexus-transition-rect",JSON.stringify({top:e.top,left:e.left,width:e.width,height:e.height}))}t.preventDefault(),this.navigateTo(e.href)}shouldTransition(t){return t.hostname===window.location.hostname&&(!t.href.startsWith("#")&&(!t.hasAttribute("download")&&("_blank"!==t.target&&(!t.classList.contains("no-transition")&&(!t.pathname.includes("/oauth/")&&!t.pathname.includes("/auth/")&&(!t.pathname.match(/\/(login|logout|register)(\/|$)/)&&(!t.pathname.includes("/federation")&&t.pathname!==window.location.pathname)))))))}async navigateTo(t,e=!1){if(!this.isTransitioning){this.isTransitioning=!0,document.documentElement.classList.toggle("navigating-back",e);try{window.NexusNative?.Haptics?window.NexusNative.Haptics.impact("light"):navigator.vibrate&&document.hasFocus()&&navigator.vibrate(10)}catch(t){}try{const i=document.startViewTransition(async()=>{const i=await fetch(t,{credentials:"include"}),n=await i.text(),a=(new DOMParser).parseFromString(n,"text/html");this.updatePage(a),e||(history.pushState({},"",t),this.navigationHistory.push(t))});await i.finished,this.matchDestinationElements(),this.assignTransitionNames(),this.reinitializeScripts()}catch(e){console.error("Transition failed:",e),window.location.href=t}finally{this.isTransitioning=!1,document.documentElement.classList.remove("navigating-back"),document.body.classList.add("view-transition-complete"),setTimeout(()=>{document.body.classList.remove("view-transition-complete")},100)}}}updatePage(t){document.title=t.title,document.documentElement.classList.remove("messages-page","messages-fullscreen","chat-page"),document.documentElement.style.overflow="",document.body.className=t.body.className,document.body.style.overflow="";t.querySelectorAll('meta[name="description"], meta[property^="og:"]').forEach(t=>{const e=document.querySelector(`meta[name="${t.name}"], meta[property="${t.getAttribute("property")}"]`);e&&e.setAttribute("content",t.getAttribute("content"))});const e=document.querySelector(".htb-hero-header"),i=t.querySelector(".htb-hero-header");if(e&&i)e.outerHTML=i.outerHTML;else if(i&&!e){const t=document.querySelector(".nexus-navbar");t&&t.insertAdjacentHTML("afterend",i.outerHTML)}else e&&!i&&e.remove();const n=[".htb-container",".htb-container-full","main","#content",".main-content"];for(const e of n){const i=document.querySelector(e),n=t.querySelector(e);if(i&&n){i.innerHTML=n.innerHTML;break}}this.updateActiveStates()}matchDestinationElements(){const t=sessionStorage.getItem("nexus-transition-source");if(t){if(t.startsWith("listing-")){t.replace("listing-","");const e=document.querySelector(".listing-detail-image, .listing-hero-image, .detail-header img");e&&(e.style.viewTransitionName=t+"-image")}if(t.startsWith("member-")){const e=document.querySelector(".profile-avatar, .profile-header img");e&&(e.style.viewTransitionName=t+"-avatar")}sessionStorage.removeItem("nexus-transition-source"),sessionStorage.removeItem("nexus-transition-rect")}}updateActiveStates(){const t=window.location.pathname;if(document.querySelectorAll(".nexus-native-nav-item").forEach(e=>{const i=e.getAttribute("href"),n=i===t||"/"!==i&&t.startsWith(i);e.classList.toggle("active",n)}),window.NexusNav?.updatePill){const t=document.querySelector(".nexus-native-nav-item.active");t&&window.NexusNav.updatePill(t)}document.querySelectorAll(".nexus-drawer-item").forEach(e=>{const i=e.getAttribute("href")===t;e.classList.toggle("active",i)})}reinitializeScripts(){window.NexusTabIcons&&(window.NexusTabIcons=new window.NexusTabIcons.constructor),window.NexusMicro&&(window.NexusMicro=new window.NexusMicro.constructor),window.scrollTo({top:0,behavior:"instant"}),document.dispatchEvent(new CustomEvent("nexus:pagechange",{detail:{url:window.location.href}}))}handlePopState(e){const i=this.navigationHistory.indexOf(window.location.href),n=-1!==i&&i<this.navigationHistory.length-1;t&&this.navigateTo(window.location.href,n)}}class i{constructor(){this.preloadedImages=new Map,this.init()}init(){document.addEventListener("mouseover",t=>{const e=t.target.closest("a");e&&!this.preloadedImages.has(e.href)&&this.preloadHero(e.href)},{passive:!0}),document.addEventListener("touchstart",t=>{const e=t.target.closest("a");e&&!this.preloadedImages.has(e.href)&&this.preloadHero(e.href)},{passive:!0})}async preloadHero(t){try{this.preloadedImages.set(t,"loading");const e=await fetch(t,{priority:"low"}),i=await e.text(),n=new DOMParser,a=n.parseFromString(i,"text/html").querySelector(".htb-hero-header img, .hero-image, .listing-image");if(a&&a.src){const e=new Image;e.src=a.src,this.preloadedImages.set(t,e.src)}}catch(e){this.preloadedImages.delete(t)}}}function n(){window.NexusSharedTransitions=new e,t&&(window.NexusHeroPreloader=new i),console.log("[NEXUS] Shared element transitions ready")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()}();