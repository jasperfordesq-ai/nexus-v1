/*!
 * jGravity v2
 * http://tinybigideas.com/plugins/jquery-gravity/
 */
(function (b) { b.fn.jGravity = function (a) { var a = b.extend({ target: "body", ignoreClass: "ignoreMe", weight: 25, depth: 5, drag: !0 }, a), e = "box_29837428937"; return this.each(function () { function c() { b(a.target).find("*").not("body, html, script, link, meta, title, style, ." + a.ignoreClass).each(function () { var a = b(this), d = a.offset(), c = a.width(), e = a.height(); 100 > c && (c = 100); 100 > e && (e = 100); a.attr("data-jgravity-h", e).attr("data-jgravity-w", c).attr("data-jgravity-l", d.left).attr("data-jgravity-t", d.top) }).addClass(e).css({ position: "absolute", overflow: "hidden" }).each(function () { var c = b(this), f = c.attr("data-jgravity-h"), g = c.attr("data-jgravity-w"), h = c.attr("data-jgravity-l"), k = c.attr("data-jgravity-t"); c.css("top", k + "px").css("left", h + "px").attr("width", g).attr("height", f) }); b("body").addClass("jGravity-active"); d() } function d() { var c = b2Vec2 = Box2D.Common.Math.b2Vec2, d = b2BodyDef = Box2D.Dynamics.b2BodyDef, k = b2Body = Box2D.Dynamics.b2Body, l = b2FixtureDef = Box2D.Dynamics.b2FixtureDef, f = b2World = Box2D.Dynamics.b2World, m = b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape; Box2D.Collision.Shapes.b2CircleShape; var n = b2DebugDraw = Box2D.Dynamics.b2DebugDraw, o = b2MouseJointDef = Box2D.Dynamics.Joints.b2MouseJointDef, f = new f(new c(0, a.weight), !0), p = 30, g = 0; b("." + e).each(function (a) { var c = b(this), e = c.width() / 2, f = c.height() / 2; g = a; a = new d; a.type = k.b2_dynamicBody; a.position.Set(c.attr("data-jgravity-l") / p + e / p, c.attr("data-jgravity-t") / p + f / p); a.userData = { id: g, elem: c[0], width: c.width(), height: c.height() }; a = f.CreateBody(a); c = new m; c.SetAsBox(e / p, f / p); e = new l; e.shape = c; e.density = 10; e.friction = .5; e.restitution = .5; a.CreateFixture(e) }); d = new d; d.type = k.b2_staticBody; d.position.Set(0, window.innerHeight / p); g = f.CreateBody(d); l = new m; l.SetAsBox(window.innerWidth / p, 10 / p); d.CreateFixture2(l); d = new d; d.type = k.b2_staticBody; d.position.Set(0, 0); g = f.CreateBody(d); l = new m; l.SetAsBox(window.innerWidth / p, 10 / p); d.CreateFixture2(l); d = new d; d.type = k.b2_staticBody; d.position.Set(window.innerWidth / p, 0); g = f.CreateBody(d); l = new m; l.SetAsBox(10 / p, window.innerHeight / p); d.CreateFixture2(l); d = new d; d.type = k.b2_staticBody; d.position.Set(0, 0); g = f.CreateBody(d); l = new m; l.SetAsBox(10 / p, window.innerHeight / p); d.CreateFixture2(l); if (a.drag) { var q; var r = function (b) { var d = new c(b.clientX / p, b.clientY / p), e = new Box2D.Collision.b2AABB; e.lowerBound.Set(d.x - .001, d.y - .001); e.upperBound.Set(d.x + .001, d.y + .001); var g = new Box2D.Dynamics.b2QueryCallback; f.QueryAABB(function (a) { if (a.GetBody().GetType() != k.b2_staticBody && a.TestPoint(d)) return g.m_fixture = a, !1; return !0 }, e); if (g.m_fixture) { var h = g.m_fixture.GetBody(), j = new o; j.bodyA = f.GetGroundBody(); j.bodyB = h; j.target = d; j.collideConnected = !0; j.maxForce = 300 * h.GetMass(); q = f.CreateJoint(j); h.SetAwake(!0) } }, s = function (b) { q && (b = new c(b.clientX / p, b.clientY / p), q.SetTarget(b)) }, t = function () { q && (f.DestroyJoint(q), q = null) } } if (a.debug) { var u = b("<canvas></canvas>").attr("width", b(window).width()).attr("height", b(window).height()).css({ position: "absolute", left: 0, top: 0, "pointer-events": "none", "z-index": 9999 }).appendTo("body"), v = new n; v.SetSprite(u[0].getContext("2d")); v.SetDrawScale(p); v.SetFillAlpha(.5); v.SetLineThickness(1); v.SetFlags(n.e_shapeBit | n.e_jointBit); f.SetDebugDraw(v) } (function w() { f.Step(1 / 60, 10, 10); f.ClearForces(); if (a.debug) f.DrawDebugData(); else for (var b = f.GetBodyList(); b; b = b.GetNext()) { var c = b.GetUserData(); if (c) { var d = c.elem, e = b.GetPosition(), g = b.GetAngle(); d.style.left = e.x * p - c.width / 2 + "px"; d.style.top = e.y * p - c.height / 2 + "px"; d.style.transform = "rotate(" + g + "rad)"; d.style.webkitTransform = "rotate(" + g + "rad)" } } a.drag && (document.addEventListener("mousedown", function (a) { r(a) }), document.addEventListener("mouseup", function () { t() }), document.addEventListener("mousemove", function (a) { s(a) })); requestAnimationFrame(w) })() } c() }) } })(jQuery);
