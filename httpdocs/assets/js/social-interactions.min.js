!function(e){"use strict";const t=e.SocialInteractions||{};function n(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function o(e){const n=t.config;return n.useCssVariables?"liked"===e?"var(--primary-color)":"var(--text-muted)":"liked"===e?n.likedColor:n.unlikedColor}function i(e,t,n){const i=t.classList.contains("feed-action-pill")||t.classList.contains("feed-action-btn");n?(e.classList.remove("fa-regular"),e.classList.add("fa-solid"),t.classList.add("liked"),i||(t.style.color=o("liked"),t.style.fontWeight="600")):(e.classList.remove("fa-solid"),e.classList.add("fa-regular"),t.classList.remove("liked"),i||(t.style.color=o("unliked"),t.style.fontWeight="normal"))}function s(e,o){const i=20*(o=o||0),a=t.config,r=e.is_edited?'<span style="font-size: 0.7rem; color: #9ca3af;"> (edited)</span>':"",l=a.enableEditDelete&&e.is_owner?`\n            <span onclick="SocialInteractions.editComment(${e.id}, '${n(e.content).replace(/'/g,"\\'").replace(/\n/g,"\\n")}')" style="cursor: pointer; margin-left: 10px; color: #6b7280; font-size: 12px;" title="Edit">‚úèÔ∏è</span>\n            <span onclick="SocialInteractions.deleteComment(${e.id})" style="cursor: pointer; margin-left: 5px; color: #6b7280; font-size: 12px;" title="Delete">üóëÔ∏è</span>\n        `:"";let d="";a.enableReactions&&e.reactions&&(d=Object.entries(e.reactions).map(([t,n])=>{const o=(e.user_reactions||[]).includes(t);return`<span class="comment-reaction ${o?"active":""}" onclick="SocialInteractions.toggleReaction(${e.id}, '${t}')" style="cursor: pointer; padding: 2px 6px; border-radius: 12px; font-size: 12px; background: ${o?"rgba(99, 102, 241, 0.2)":"var(--reaction-bg, rgba(243, 244, 246, 0.8))"}; border: 1px solid ${o?"rgba(99, 102, 241, 0.4)":"var(--reaction-border, rgba(229, 231, 235, 0.8))"}; margin-right: 4px;">${t} ${n}</span>`}).join(""));let c="";if(a.enableReactions&&t.isLoggedIn){const n=t.state.availableReactions;c=`\n                <div class="reaction-picker" style="display: inline-block; position: relative;">\n                    <span class="reaction-add-btn" onclick="SocialInteractions.toggleReactionPicker(${e.id})" style="cursor: pointer; padding: 2px 6px; border-radius: 12px; font-size: 12px; background: var(--reaction-bg, rgba(243, 244, 246, 0.8)); border: 1px solid var(--reaction-border, rgba(229, 231, 235, 0.8));">+</span>\n                    <div id="reaction-picker-${e.id}" class="reaction-picker-popup" style="display: none; position: absolute; bottom: 24px; left: 0; background: var(--picker-bg, white); border-radius: 20px; padding: 4px 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); white-space: nowrap; z-index: 100; border: 1px solid var(--picker-border, transparent);">\n                        ${n.map(t=>`<span onclick="SocialInteractions.toggleReaction(${e.id}, '${t}')" style="cursor: pointer; padding: 4px; font-size: 18px; transition: transform 0.1s;" onmouseover="this.style.transform='scale(1.3)'" onmouseout="this.style.transform='scale(1)'">${t}</span>`).join("")}\n                    </div>\n                </div>\n            `}const m=a.enableReplies&&t.isLoggedIn?`<span class="comment-reply-link" onclick="SocialInteractions.showReplyForm(${e.id})" style="cursor: pointer; margin-left: 10px; color: var(--action-text, #6b7280); font-size: 12px;">Reply</span>`:"",p=a.enableReplies&&e.replies?e.replies.map(e=>s(e,o+1)).join(""):"";let u=n(e.content);return a.enableMentions&&(u=u.replace(/@(\w+)/g,'<span style="color: #4f46e5; font-weight: 600;">@$1</span>')),`\n            <div class="comment-item" style="margin-left: ${i}px; margin-bottom: 12px;" id="comment-${e.id}">\n                <div style="display: flex; gap: 8px;">\n                    <img src="${n(e.author_avatar)}" class="comment-avatar" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; flex-shrink: 0;">\n                    <div style="flex-grow: 1;">\n                        <div class="comment-bubble" style="background: var(--comment-bg, rgba(243, 244, 246, 0.8)); backdrop-filter: blur(8px); padding: 8px 12px; border-radius: 18px; display: inline-block; max-width: 100%; border: 1px solid var(--comment-border, transparent);">\n                            <div class="comment-author" style="font-weight: 600; font-size: 13px; color: var(--comment-text, #1f2937);">${n(e.author_name)}${r}</div>\n                            <div class="comment-text" style="font-size: 14px; color: var(--comment-text, #1f2937); word-wrap: break-word;">${u}</div>\n                        </div>\n                        <div class="comment-actions" style="margin-top: 4px; display: flex; align-items: center; flex-wrap: wrap; gap: 4px;">\n                            ${d}\n                            ${c}\n                            ${m}\n                            ${l}\n                        </div>\n                        <div id="reply-form-${e.id}" class="comment-reply-form" style="display: none; margin-top: 8px;">\n                            <div style="display: flex; gap: 8px; align-items: center;">\n                                <input type="text" class="fds-input comment-reply-input" placeholder="Write a reply..." style="flex-grow: 1; border-radius: 20px; padding: 8px 12px; font-size: 13px; background: var(--comment-input-bg, #fff); color: var(--comment-text, #1f2937); border: 1px solid var(--comment-border, #e5e7eb);" onkeydown="if(event.key === 'Enter') SocialInteractions.submitReply(${e.id}, this)">\n                                <button class="comment-reply-btn" onclick="SocialInteractions.submitReply(${e.id}, this.previousElementSibling)" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.9), rgba(139, 92, 246, 0.9)); color: white; border: none; border-radius: 20px; padding: 8px 16px; cursor: pointer; font-size: 13px;">Reply</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                ${p}\n            </div>\n        `}function a(e,o,i,s,a,r){fetch(t.apiBase+"/likers",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({target_type:e,target_id:o,page:i})}).then(e=>e.json()).then(e=>{if("success"===e.status){const t=e.total_count||0;if(r.textContent=1===t?"1 Like":t+" Likes",1===i&&(s.innerHTML=""),e.likers&&e.likers.length>0){const t=window.BASE_URL||"";if(e.likers.forEach(e=>{const o=document.createElement("a");o.href=t+"/profile/"+e.id,o.className="liker-item",o.innerHTML=`\n                            <img src="${n(e.avatar_url)}" alt="${n(e.name)}" class="liker-avatar">\n                            <div class="liker-info">\n                                <div class="liker-name">${n(e.name)}</div>\n                                <div class="liker-date">Liked ${n(e.liked_at_formatted)}</div>\n                            </div>\n                        `,s.appendChild(o)}),e.has_more){a.classList.remove("hidden");document.getElementById("likers-modal").dataset.page=i+1}else a.classList.add("hidden")}else 1===i&&(s.innerHTML='\n                        <div class="likers-empty">\n                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>\n                            </svg>\n                            <p>No likes yet</p>\n                        </div>\n                    ')}else s.innerHTML='<div class="likers-empty">Failed to load likes</div>'}).catch(e=>{console.error("Fetch likers error:",e),s.innerHTML='<div class="likers-empty">Failed to load likes</div>'})}t.apiBase=(window.BASE_URL||"")+"/api/social",t.config=t.config||{likedColor:"#4f46e5",unlikedColor:"#6b7280",primaryColor:"#4f46e5",useCssVariables:!1,enableHeartBurst:!0,enableHaptics:!0,enableRipple:!0,toastDuration:3e3,enableReactions:!0,enableReplies:!0,enableMentions:!0,enableEditDelete:!0},t.state={availableReactions:["‚ù§Ô∏è","üëç","üòÇ","üòÆ","üò¢","üò°"],currentCommentTargetType:"",currentCommentTargetId:0},t.showToast=function(e,n){if(n=n||"success","undefined"!=typeof Toast&&Toast[n])return void Toast[n](e);let o=document.getElementById("snackbar")||document.getElementById("toast");o||(o=document.createElement("div"),o.id="snackbar",o.style.cssText="\n                visibility: hidden;\n                min-width: 250px;\n                margin-left: -125px;\n                background-color: #333;\n                color: #fff;\n                text-align: center;\n                border-radius: 8px;\n                padding: 16px;\n                position: fixed;\n                z-index: 10001;\n                left: 50%;\n                bottom: 30px;\n                font-size: 14px;\n            ",document.body.appendChild(o)),o.innerText=e,o.className="show",o.classList.add("js-toast-visible"),o.classList.remove("js-toast-hidden"),setTimeout(function(){o.className=o.className.replace("show",""),o.classList.remove("js-toast-visible"),o.classList.add("js-toast-hidden")},t.config.toastDuration)},t.showError=function(e){t.showToast(e,"error")},t.createHeartBurst=function(e){if(!t.config.enableHeartBurst)return;const n=e.getBoundingClientRect(),o=n.left+n.width/2,i=n.top+n.height/2,s=["‚ù§Ô∏è","üíú","üíô","üß°","üíó"];for(let e=0;e<6;e++){const e=document.createElement("div");e.textContent=s[Math.floor(Math.random()*s.length)],e.style.cssText=`\n                position: fixed;\n                left: ${o}px;\n                top: ${i}px;\n                font-size: ${16+10*Math.random()}px;\n                pointer-events: none;\n                z-index: 10000;\n                animation: heartBurst ${.6+.3*Math.random()}s ease-out forwards;\n                --tx: ${120*(Math.random()-.5)}px;\n                --ty: ${-60-80*Math.random()}px;\n            `,document.body.appendChild(e),setTimeout(()=>e.remove(),1e3)}},function(){if(document.getElementById("social-heart-burst-css"))return;const e=document.createElement("style");e.id="social-heart-burst-css",e.textContent="\n            @keyframes heartBurst {\n                0% { transform: translate(0, 0) scale(1); opacity: 1; }\n                100% { transform: translate(var(--tx), var(--ty)) scale(0.5); opacity: 0; }\n            }\n            @keyframes like-pop {\n                0% { transform: scale(1); }\n                50% { transform: scale(1.4); }\n                100% { transform: scale(1); }\n            }\n            .like-pop { animation: like-pop 0.4s ease; }\n            .rippling { animation: ripple 0.6s ease-out; }\n            @keyframes ripple {\n                0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }\n                100% { box-shadow: 0 0 0 15px rgba(99, 102, 241, 0); }\n            }\n        ",document.head.appendChild(e)}(),t._likeDebounce={},t.toggleLike=function(e,n,s){if(!t.isLoggedIn)return void(window.location.href=(window.BASE_URL||"")+"/login?redirect="+encodeURIComponent(window.location.pathname));const a=e.querySelector("i");if(!a)return;const r=n+"-"+s;if(t._likeDebounce[r])return;t._likeDebounce[r]=!0,setTimeout(function(){delete t._likeDebounce[r]},500);const l=a.classList.contains("fa-solid"),d=t.config,c=e.classList.contains("feed-action-pill")||e.classList.contains("feed-action-btn");d.enableRipple&&(e.classList.add("rippling"),setTimeout(()=>e.classList.remove("rippling"),600)),l?(a.classList.remove("fa-solid"),a.classList.add("fa-regular"),e.classList.remove("liked"),c||(e.style.color=o("unliked"),e.style.fontWeight="normal")):(a.classList.remove("fa-regular"),a.classList.add("fa-solid"),e.classList.add("liked"),c||(e.style.color=o("liked"),e.style.fontWeight="600"),t.createHeartBurst(e),a.classList.add("like-pop"),setTimeout(()=>a.classList.remove("like-pop"),400),d.enableHaptics&&navigator.vibrate&&navigator.vibrate([10,50,20])),fetch(t.apiBase+"/like",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({target_type:n,target_id:s})}).then(e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.json()}).then(n=>{if("liked"===n.status||"unliked"===n.status){const o=e.querySelector(".likes-count")||e.parentElement.querySelector(".likes-count");o&&void 0!==n.likes_count&&(o.textContent=n.likes_count>0?n.likes_count:"");const i=e.querySelector(".like-label");if(i&&void 0!==n.likes_count){const e=n.likes_count,t=1===e?"Like":"Likes";i.textContent=e>0?e+" "+t:t}"liked"===n.status&&t.showToast("Liked!","success")}else i(a,e,l),t.showError("Failed to update like"),console.error("Like failed:",n)}).catch(n=>{i(a,e,l),t.showError("Connection error. Please try again."),console.error("Like error:",n)})},t.toggleCommentSection=function(e,n){const o=document.getElementById(`comments-section-${e}-${n}`);if(!o)return;if(o.classList.contains("fds-comments-section")?!o.classList.contains("active"):"none"===window.getComputedStyle(o).display){o.classList.contains("fds-comments-section")?o.classList.add("active"):o.classList.remove("hidden");const i=o.querySelector("input");i&&i.focus(),t.fetchComments(e,n)}else o.classList.contains("fds-comments-section")?o.classList.remove("active"):o.classList.add("hidden")},t.fetchComments=function(e,o){const i=document.querySelector(`#comments-section-${e}-${o} .comments-list`);i&&(i.innerHTML='<div style="color:#6b7280; padding:10px;">Loading...</div>',t.state.currentCommentTargetType=e,t.state.currentCommentTargetId=o,fetch(t.apiBase+"/comments",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"fetch",target_type:e,target_id:o})}).then(e=>e.json()).then(e=>{if(e.available_reactions&&(t.state.availableReactions=e.available_reactions),"success"===e.status&&e.comments&&e.comments.length>0){const o=t.config,a=o.enableReactions||o.enableReplies||o.enableEditDelete;i.innerHTML=a?e.comments.map(e=>s(e,0)).join(""):e.comments.map(e=>function(e){return`\n            <div class="comment-item" style="display:flex; gap:8px; margin-bottom:10px;">\n                <img src="${n(e.author_avatar)}" class="comment-avatar" style="width:32px; height:32px; border-radius:50%; object-fit:cover;">\n                <div class="comment-bubble" style="background:var(--comment-bg, rgba(243, 244, 246, 0.8)); backdrop-filter:blur(8px); padding:8px 12px; border-radius:18px; border: 1px solid var(--comment-border, transparent);">\n                    <div class="comment-author" style="font-weight:600; font-size:13px; color:var(--comment-text, #1f2937);">${n(e.author_name)}</div>\n                    <div class="comment-text" style="font-size:14px; color:var(--comment-text, #1f2937);">${n(e.content)}</div>\n                </div>\n            </div>`}(e)).join("")}else i.innerHTML='<div style="color:#9ca3af; padding:10px; font-size:14px;">No comments yet. Be the first!</div>'}).catch(e=>{i.innerHTML='<div style="color:#ef4444; padding:10px; font-size:13px;">Error loading comments.</div>',console.error("Fetch comments error:",e)}))},t.submitComment=function(e,n,o){if(!t.isLoggedIn)return void(window.location.href=(window.BASE_URL||"")+"/login?redirect="+encodeURIComponent(window.location.pathname));const i=e.value.trim();i&&(e.disabled=!0,t.state.currentCommentTargetType=n,t.state.currentCommentTargetId=o,fetch(t.apiBase+"/comments",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"submit",target_type:n,target_id:o,content:i})}).then(e=>e.json()).then(i=>{e.disabled=!1,"success"===i.status?(e.value="",e.focus(),t.fetchComments(n,o),t.showToast("Comment posted!","success")):t.showError(i.error||i.message||"Failed to post comment")}).catch(n=>{e.disabled=!1,console.error("Submit comment error:",n),t.showError("Failed to post comment. Please try again.")}))},t.toggleReactionPicker=function(e){const t=document.getElementById(`reaction-picker-${e}`);t&&t.classList.toggle("hidden")},t.toggleReaction=function(e,n){if(!t.isLoggedIn)return void(window.location.href=(window.BASE_URL||"")+"/login?redirect="+encodeURIComponent(window.location.pathname));const o=document.getElementById(`reaction-picker-${e}`);o&&o.classList.add("hidden"),fetch(t.apiBase+"/reaction",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({comment_id:e,emoji:n})}).then(e=>e.json()).then(e=>{"success"!==e.status&&"added"!==e.status&&"removed"!==e.status||t.fetchComments(t.state.currentCommentTargetType,t.state.currentCommentTargetId)})},t.showReplyForm=function(e){const t=document.getElementById(`reply-form-${e}`);if(t){t.classList.toggle("hidden");const e=t.querySelector("input");e&&!t.classList.contains("hidden")&&e.focus()}},t.submitReply=function(e,n){const o=n.value.trim();o&&(n.disabled=!0,fetch(t.apiBase+"/reply",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({target_type:t.state.currentCommentTargetType,target_id:t.state.currentCommentTargetId,parent_id:e,content:o})}).then(e=>e.json()).then(e=>{n.disabled=!1,n.value="","success"===e.status?(t.fetchComments(t.state.currentCommentTargetType,t.state.currentCommentTargetId),t.showToast("Reply posted!","success")):e.error&&t.showError(e.error)}))},t.editComment=function(e,n){const o=prompt("Edit your comment:",n.replace(/\\n/g,"\n"));null!==o&&""!==o.trim()&&o!==n&&fetch(t.apiBase+"/edit-comment",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({comment_id:e,content:o.trim()})}).then(e=>e.json()).then(e=>{"success"===e.status?(t.fetchComments(t.state.currentCommentTargetType,t.state.currentCommentTargetId),t.showToast("Comment updated!","success")):e.error&&t.showError(e.error)})},t.deleteComment=function(e){confirm("Delete this comment?")&&fetch(t.apiBase+"/delete-comment",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({comment_id:e})}).then(e=>e.json()).then(e=>{"success"===e.status?(t.fetchComments(t.state.currentCommentTargetType,t.state.currentCommentTargetId),t.showToast("Comment deleted!","success")):e.error&&t.showError(e.error)})},t.repostToFeed=function(e,n,o){t.isLoggedIn?confirm("Share this post to your feed?")&&fetch(t.apiBase+"/share",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({parent_id:n,parent_type:e||"post",original_author:o})}).then(e=>e.json()).then(e=>{"success"===e.status?(t.showToast("Shared to your feed!","success"),setTimeout(()=>location.reload(),1e3)):t.showError("Share failed: "+(e.error||"Unknown error"))}).catch(e=>{console.error("Share error:",e),t.showError("Share failed. Please try again.")}):window.location.href=(window.BASE_URL||"")+"/login?redirect="+encodeURIComponent(window.location.pathname)},t.deletePost=function(e,n){confirm("Delete this post?")&&fetch(t.apiBase+"/delete",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({target_type:e,target_id:n})}).then(e=>e.json()).then(e=>{"deleted"===e.status||"success"===e.status?(t.showToast("Post deleted!","success"),setTimeout(()=>location.reload(),500)):e.error&&t.showError("Delete failed: "+e.error)})},t.searchMentions=function(e,n){!e||e.length<2?n([]):fetch(t.apiBase+"/mention-search",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({query:e})}).then(e=>e.json()).then(e=>{"success"===e.status&&e.users?n(e.users):n([])}).catch(()=>n([]))},t.initMentionAutocomplete=function(e){if(!t.config.enableMentions||!e)return;let o=null,i=-1;function s(){o&&(o.remove(),o=null)}e.addEventListener("input",function(a){const r=this.value,l=this.selectionStart,d=r.substring(0,l),c=d.lastIndexOf("@");if(c>=0){const a=d.substring(c+1);a.length>=2&&!a.includes(" ")?(i=c,t.searchMentions(a,function(t){t.length>0?function(e,t){s(),o=document.createElement("div"),o.className="mention-dropdown",o.style.cssText="\n                position: absolute;\n                background: white;\n                border: 1px solid #e5e7eb;\n                border-radius: 8px;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n                max-height: 200px;\n                overflow-y: auto;\n                z-index: 1000;\n                min-width: 200px;\n            ",t.forEach(t=>{const a=document.createElement("div");a.style.cssText="\n                    padding: 8px 12px;\n                    cursor: pointer;\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                ",a.innerHTML=`\n                    <img src="${n(t.avatar||"/assets/img/defaults/default_avatar.png")}"\n                         style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover;">\n                    <span style="font-weight: 600;">${n(t.name)}</span>\n                    <span style="color: #6b7280; font-size: 12px;">@${n(t.username)}</span>\n                `,a.addEventListener("mouseover",()=>a.style.background="#f3f4f6"),a.addEventListener("mouseout",()=>a.style.background="white"),a.addEventListener("click",()=>{!function(e,t){const n=e.value,o=e.selectionStart,s=n.substring(0,i),a=n.substring(o);e.value=s+"@"+t+" "+a;const r=i+t.length+2;e.setSelectionRange(r,r),e.focus()}(e,t.username),s()}),o.appendChild(a)});const a=e.getBoundingClientRect();o.style.left=a.left+"px",o.style.top=a.bottom+5+"px",document.body.appendChild(o)}(e,t):s()})):s()}else s()}),document.addEventListener("click",function(t){o&&!o.contains(t.target)&&t.target!==e&&s()})},t.showLikers=function(e,t){let n=document.getElementById("likers-modal");n||(n=function(){const e=document.createElement("div");return e.id="likers-modal",e.className="likers-modal",e.innerHTML='\n            <div class="likers-modal-overlay" onclick="SocialInteractions.closeLikersModal()"></div>\n            <div class="likers-modal-container">\n                <div class="likers-modal-header">\n                    <h3 class="likers-modal-title">Likes</h3>\n                    <button class="likers-modal-close" onclick="SocialInteractions.closeLikersModal()" aria-label="Close">\n                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                            <line x1="18" y1="6" x2="6" y2="18"></line>\n                            <line x1="6" y1="6" x2="18" y2="18"></line>\n                        </svg>\n                    </button>\n                </div>\n                <div class="likers-modal-body"></div>\n                <div class="likers-modal-footer">\n                    <button class="likers-load-more" onclick="SocialInteractions.loadMoreLikers()" style="display: none;">Load More</button>\n                </div>\n            </div>\n        ',function(){if(document.getElementById("likers-modal-styles"))return;const e=document.createElement("style");e.id="likers-modal-styles",e.textContent='\n            .likers-modal {\n                display: none;\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                z-index: 10000;\n                align-items: center;\n                justify-content: center;\n            }\n            .likers-modal.active {\n                display: flex;\n            }\n            .likers-modal-overlay {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0, 0, 0, 0.5);\n                backdrop-filter: blur(4px);\n            }\n            .likers-modal-container {\n                position: relative;\n                background: var(--modal-bg, #fff);\n                border-radius: 16px;\n                width: 90%;\n                max-width: 400px;\n                max-height: 80vh;\n                display: flex;\n                flex-direction: column;\n                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n                animation: likers-modal-in 0.2s ease-out;\n            }\n            @keyframes likers-modal-in {\n                from { opacity: 0; transform: scale(0.95) translateY(10px); }\n                to { opacity: 1; transform: scale(1) translateY(0); }\n            }\n            .likers-modal-header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                padding: 16px 20px;\n                border-bottom: 1px solid var(--border-color, #e5e7eb);\n            }\n            .likers-modal-title {\n                margin: 0;\n                font-size: 18px;\n                font-weight: 600;\n                color: var(--text-primary, #1f2937);\n            }\n            .likers-modal-close {\n                background: none;\n                border: none;\n                cursor: pointer;\n                padding: 4px;\n                color: var(--text-muted, #6b7280);\n                border-radius: 8px;\n                transition: background 0.2s, color 0.2s;\n            }\n            .likers-modal-close:hover {\n                background: var(--hover-bg, #f3f4f6);\n                color: var(--text-primary, #1f2937);\n            }\n            .likers-modal-body {\n                flex: 1;\n                overflow-y: auto;\n                padding: 8px 0;\n                min-height: 100px;\n            }\n            .likers-modal-footer {\n                padding: 12px 20px;\n                border-top: 1px solid var(--border-color, #e5e7eb);\n                text-align: center;\n            }\n            .likers-loading {\n                text-align: center;\n                padding: 40px 20px;\n                color: var(--text-muted, #6b7280);\n            }\n            .likers-empty {\n                text-align: center;\n                padding: 40px 20px;\n                color: var(--text-muted, #6b7280);\n            }\n            .likers-empty svg {\n                width: 48px;\n                height: 48px;\n                margin-bottom: 12px;\n                opacity: 0.5;\n            }\n            .liker-item {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                padding: 12px 20px;\n                transition: background 0.2s;\n                cursor: pointer;\n                text-decoration: none;\n                color: inherit;\n            }\n            .liker-item:hover {\n                background: var(--hover-bg, #f9fafb);\n            }\n            .liker-avatar {\n                width: 44px;\n                height: 44px;\n                border-radius: 50%;\n                object-fit: cover;\n                flex-shrink: 0;\n            }\n            .liker-info {\n                flex: 1;\n                min-width: 0;\n            }\n            .liker-name {\n                font-weight: 600;\n                font-size: 15px;\n                color: var(--text-primary, #1f2937);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .liker-date {\n                font-size: 13px;\n                color: var(--text-muted, #6b7280);\n            }\n            .likers-load-more {\n                background: var(--primary-color, #4f46e5);\n                color: white;\n                border: none;\n                border-radius: 8px;\n                padding: 10px 24px;\n                font-size: 14px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: background 0.2s, transform 0.1s;\n            }\n            .likers-load-more:hover {\n                background: var(--primary-hover, #4338ca);\n            }\n            .likers-load-more:active {\n                transform: scale(0.98);\n            }\n            .likes-count-clickable {\n                cursor: pointer;\n                transition: opacity 0.2s;\n            }\n            .likes-count-clickable:hover {\n                opacity: 0.7;\n            }\n\n            /* Dark mode styles for likers modal */\n            [data-theme="dark"] .likers-modal-container,\n            .dark .likers-modal-container {\n                background: #1e293b;\n                border: 1px solid rgba(139, 92, 246, 0.3);\n            }\n            [data-theme="dark"] .likers-modal-header,\n            .dark .likers-modal-header {\n                border-bottom-color: rgba(139, 92, 246, 0.2);\n            }\n            [data-theme="dark"] .likers-modal-title,\n            .dark .likers-modal-title {\n                color: #f1f5f9;\n            }\n            [data-theme="dark"] .likers-modal-close,\n            .dark .likers-modal-close {\n                color: #94a3b8;\n            }\n            [data-theme="dark"] .likers-modal-close:hover,\n            .dark .likers-modal-close:hover {\n                background: rgba(139, 92, 246, 0.2);\n                color: #f1f5f9;\n            }\n            [data-theme="dark"] .likers-modal-footer,\n            .dark .likers-modal-footer {\n                border-top-color: rgba(139, 92, 246, 0.2);\n            }\n            [data-theme="dark"] .likers-loading,\n            [data-theme="dark"] .likers-empty,\n            .dark .likers-loading,\n            .dark .likers-empty {\n                color: #94a3b8;\n            }\n            [data-theme="dark"] .liker-item:hover,\n            .dark .liker-item:hover {\n                background: rgba(139, 92, 246, 0.1);\n            }\n            [data-theme="dark"] .liker-name,\n            .dark .liker-name {\n                color: #f1f5f9;\n            }\n            [data-theme="dark"] .liker-date,\n            .dark .liker-date {\n                color: #94a3b8;\n            }\n\n            /* System dark mode preference */\n            @media (prefers-color-scheme: dark) {\n                body:not([data-theme="light"]) .likers-modal-container {\n                    background: #1e293b;\n                    border: 1px solid rgba(139, 92, 246, 0.3);\n                }\n                body:not([data-theme="light"]) .likers-modal-header {\n                    border-bottom-color: rgba(139, 92, 246, 0.2);\n                }\n                body:not([data-theme="light"]) .likers-modal-title {\n                    color: #f1f5f9;\n                }\n                body:not([data-theme="light"]) .likers-modal-close {\n                    color: #94a3b8;\n                }\n                body:not([data-theme="light"]) .likers-modal-close:hover {\n                    background: rgba(139, 92, 246, 0.2);\n                    color: #f1f5f9;\n                }\n                body:not([data-theme="light"]) .likers-modal-footer {\n                    border-top-color: rgba(139, 92, 246, 0.2);\n                }\n                body:not([data-theme="light"]) .likers-loading,\n                body:not([data-theme="light"]) .likers-empty {\n                    color: #94a3b8;\n                }\n                body:not([data-theme="light"]) .liker-item:hover {\n                    background: rgba(139, 92, 246, 0.1);\n                }\n                body:not([data-theme="light"]) .liker-name {\n                    color: #f1f5f9;\n                }\n                body:not([data-theme="light"]) .liker-date {\n                    color: #94a3b8;\n                }\n            }\n        ',document.head.appendChild(e)}(),document.body.appendChild(e),e}());const o=n.querySelector(".likers-modal-body"),i=n.querySelector(".likers-modal-title"),s=n.querySelector(".likers-load-more");i.textContent="Likes",o.innerHTML='<div class="likers-loading">Loading...</div>',s.classList.add("hidden"),n.dataset.type=e,n.dataset.id=t,n.dataset.page=1,n.classList.add("active"),document.body.classList.add("js-overflow-hidden"),a(e,t,1,o,s,i)},t.loadMoreLikers=function(){const e=document.getElementById("likers-modal");if(!e)return;a(e.dataset.type,e.dataset.id,parseInt(e.dataset.page||1),e.querySelector(".likers-modal-body"),e.querySelector(".likers-load-more"),e.querySelector(".likers-modal-title"))},t.closeLikersModal=function(){const e=document.getElementById("likers-modal");e&&(e.classList.remove("active"),document.body.classList.remove("js-overflow-hidden"))},document.addEventListener("keydown",function(e){"Escape"===e.key&&t.closeLikersModal()}),t.loadFeed=function(e,n){const o=e.page||1,i=e.limit||10,s=e.type||null,a={page:o,limit:i};s&&(a.type=s),fetch(t.apiBase+"/feed",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{"success"===e.status?n(null,{items:e.items||[],page:e.page,limit:e.limit,hasMore:e.has_more}):n(e.error||"Failed to load feed")}).catch(e=>{n(e.message||"Network error")})},t.createPost=function(e,n){if(!t.isLoggedIn)return void(window.location.href=(window.BASE_URL||"")+"/login?redirect="+encodeURIComponent(window.location.pathname));const o=(e.content||"").trim();o?fetch(t.apiBase+"/create-post",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({content:o,image_url:e.image_url||null,visibility:e.visibility||"public"})}).then(e=>e.json()).then(e=>{if("success"===e.status)t.showToast("Post created!","success"),n?n(null,e):setTimeout(()=>location.reload(),500);else{const o=e.error||"Failed to create post.";n?n(o):t.showError(o)}}).catch(e=>{const o=e.message||"Network error";n?n(o):t.showError("Failed to create post. Please try again.")}):n?n("Post content cannot be empty."):alert("Post content cannot be empty.")},e.toggleLike=t.toggleLike,e.toggleCommentSection=t.toggleCommentSection,e.fetchComments=t.fetchComments,e.submitComment=t.submitComment,e.repostToFeed=t.repostToFeed,e.deletePost=t.deletePost,e.showToast=t.showToast,e.toggleReactionPicker=t.toggleReactionPicker,e.toggleReaction=t.toggleReaction,e.showReplyForm=t.showReplyForm,e.submitReply=t.submitReply,e.editComment=t.editComment,e.deleteComment=t.deleteComment,e.searchMentions=t.searchMentions,e.initMentionAutocomplete=t.initMentionAutocomplete,e.loadFeed=t.loadFeed,e.createPost=t.createPost,e.showLikers=t.showLikers,e.closeLikersModal=t.closeLikersModal,e.loadMoreLikers=t.loadMoreLikers,console.warn("[SocialInteractions] Module loaded, showLikers available:",typeof t.showLikers),e.SocialInteractions=t}("undefined"!=typeof window?window:this);