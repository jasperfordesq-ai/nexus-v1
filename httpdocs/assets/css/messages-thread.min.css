:root{--chat-primary:#6366f1;--chat-gradient:linear-gradient(135deg, #6366f1, #8b5cf6);--chat-bg:#f1f5f9;--chat-surface:#ffffff;--chat-border:rgba(0, 0, 0, 0.08);--chat-text:#1e293b;--chat-text-muted:#64748b;--chat-sent-bg:var(--chat-gradient);--chat-sent-text:#ffffff;--chat-received-bg:#ffffff;--chat-received-text:#1e293b;--chat-radius:18px;--safe-top:env(safe-area-inset-top, 0px);--safe-bottom:env(safe-area-inset-bottom, 0px)}[data-theme=dark]{--chat-bg:#0f172a;--chat-surface:#1e293b;--chat-border:rgba(255, 255, 255, 0.1);--chat-text:#f1f5f9;--chat-text-muted:#94a3b8;--chat-received-bg:#334155;--chat-received-text:#f1f5f9}body.chat-page,html.chat-page{overflow:hidden!important;overscroll-behavior:none!important;overscroll-behavior-y:none!important;-webkit-overflow-scrolling:auto!important;height:100dvh;height:100vh;width:100%;touch-action:manipulation;padding-bottom:0!important}.chat-page #aiChatWidget,.chat-page #mobileTabBar,.chat-page .ai-chat-widget,.chat-page .mobile-tab-bar,.chat-page .nexus-ai-chat-fab,.chat-page .nexus-bottom-sheet,.chat-page .nexus-desktop-only,.chat-page .nexus-modern-footer,.chat-page .nexus-native-nav,.chat-page .nexus-quick-fab{display:none!important}.chat-app{position:fixed;inset:0;display:flex;flex-direction:column;background:var(--chat-bg);z-index:100000;overflow:hidden}.chat-header{flex-shrink:0;display:flex;align-items:center;gap:12px;padding:10px 12px;padding-top:calc(10px + var(--safe-top));background:var(--chat-surface);border-bottom:1px solid var(--chat-border)}.chat-back{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;background:0 0;border:none;color:var(--chat-primary);font-size:1.1rem;text-decoration:none;flex-shrink:0;-webkit-tap-highlight-color:transparent}.chat-back:active{background:rgba(99,102,241,.1)}.chat-user{display:flex;align-items:center;gap:10px;flex:1;min-width:0;text-decoration:none;color:inherit}.chat-avatar{width:40px;height:40px;border-radius:50%;background:var(--chat-gradient);display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:1rem;flex-shrink:0;overflow:hidden}.chat-avatar img{width:100%;height:100%;object-fit:cover}.chat-user-info{min-width:0}.chat-user-name{font-weight:600;font-size:1rem;color:var(--chat-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.chat-user-status{font-size:.75rem;color:var(--chat-text-muted);display:flex;align-items:center;gap:4px}.chat-online-dot{width:8px;height:8px;border-radius:50%;background:#22c55e}.chat-typing{color:var(--chat-primary);font-style:italic}.chat-messages{flex:1;overflow-y:auto;overflow-x:hidden;padding:16px;display:flex;flex-direction:column;gap:8px;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;overscroll-behavior-y:contain;touch-action:pan-y;position:relative;isolation:isolate}.chat-messages::-webkit-scrollbar{display:none}.chat-date{text-align:center;padding:8px 0}.chat-date span{display:inline-block;padding:4px 12px;background:rgba(0,0,0,.05);border-radius:12px;font-size:.75rem;color:var(--chat-text-muted);font-weight:500}[data-theme=dark] .chat-date span{background:rgba(255,255,255,.08)}.chat-bubble{max-width:80%;padding:10px 14px;border-radius:var(--chat-radius);font-size:.95rem;line-height:1.4;word-wrap:break-word;position:relative;animation:bubbleIn .2s ease}@keyframes bubbleIn{from{opacity:0;transform:translateY(8px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}.chat-bubble.sent{align-self:flex-end;background:var(--chat-sent-bg);color:var(--chat-sent-text);border-bottom-right-radius:4px}.chat-bubble.received{align-self:flex-start;background:var(--chat-received-bg);color:var(--chat-received-text);border-bottom-left-radius:4px;box-shadow:0 1px 2px rgba(0,0,0,.05)}.chat-bubble-time{font-size:.65rem;opacity:.7;margin-top:4px;display:flex;align-items:center;gap:4px}.chat-bubble.sent .chat-bubble-time{justify-content:flex-end}.chat-check{font-size:.6rem}.chat-empty{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 24px;text-align:center}.chat-empty-icon{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,rgba(99,102,241,.1),rgba(139,92,246,.1));display:flex;align-items:center;justify-content:center;margin-bottom:16px}.chat-empty-icon i{font-size:1.5rem;color:var(--chat-primary)}.chat-empty p{margin:0;color:var(--chat-text-muted);font-size:.9rem}.chat-input-area{flex-shrink:0;display:flex;align-items:flex-end;gap:8px;padding:12px;padding-bottom:calc(12px + var(--safe-bottom));background:var(--chat-surface);border-top:1px solid var(--chat-border)}.chat-input-wrap{flex:1;position:relative}.chat-input{width:100%;min-height:44px;max-height:120px;padding:12px 16px;border:1px solid var(--chat-border);border-radius:22px;background:var(--chat-bg);font-size:16px;color:var(--chat-text);outline:0;resize:none;line-height:1.4;font-family:inherit}.chat-input::placeholder{color:var(--chat-text-muted)}.chat-input:focus{border-color:var(--chat-primary)}.chat-send-btn{width:44px;height:44px;border-radius:50%;background:var(--chat-gradient);border:none;color:#fff;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:opacity .2s,transform .1s;-webkit-tap-highlight-color:transparent}.chat-send-btn:disabled{opacity:.5;cursor:not-allowed}.chat-send-btn:active:not(:disabled){transform:scale(.95)}.chat-voice-btn{width:44px;height:44px;border-radius:50%;background:0 0;border:1px solid var(--chat-border);color:var(--chat-text-muted);font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s;-webkit-tap-highlight-color:transparent}.chat-voice-btn:hover{background:var(--chat-bg);color:var(--chat-primary)}.chat-voice-btn.recording{background:#ef4444;border-color:#ef4444;color:#fff;animation:pulse 1s ease-in-out infinite}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}.voice-recording-overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:100010;display:none;flex-direction:column;align-items:center;justify-content:center;gap:24px}.voice-recording-overlay.active{display:flex}.voice-recording-visual{width:120px;height:120px;border-radius:50%;background:linear-gradient(135deg,#ef4444,#dc2626);display:flex;align-items:center;justify-content:center;animation:pulse 1s ease-in-out infinite}.voice-recording-visual i{font-size:3rem;color:#fff}.voice-recording-time{font-size:2rem;font-weight:600;color:#fff;font-variant-numeric:tabular-nums}.voice-recording-hint{color:rgba(255,255,255,.7);font-size:.9rem}.voice-recording-actions{display:flex;gap:24px;margin-top:16px}.voice-recording-cancel,.voice-recording-send{width:56px;height:56px;border-radius:50%;border:none;font-size:1.25rem;cursor:pointer;display:flex;align-items:center;justify-content:center}.voice-recording-cancel{background:rgba(255,255,255,.1);color:#fff}.voice-recording-send{background:var(--chat-gradient);color:#fff}.voice-message{display:flex;align-items:center;gap:10px;min-width:180px}.voice-play-btn{width:36px;height:36px;border-radius:50%;border:none;background:rgba(255,255,255,.2);color:inherit;font-size:.9rem;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}.chat-bubble.received .voice-play-btn{background:rgba(0,0,0,.1)}.voice-waveform{flex:1;height:24px;display:flex;align-items:center;gap:2px}.voice-waveform span{flex:1;background:currentColor;opacity:.4;border-radius:2px;height:100%;max-height:24px}.voice-duration{font-size:.75rem;opacity:.8;min-width:32px}.msg-actions-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:100005;display:none;align-items:center;justify-content:center;padding:20px}.msg-actions-overlay.active{display:flex}.msg-actions-sheet{width:100%;max-width:300px;background:var(--chat-surface);border-radius:16px;overflow:hidden;transform:scale(.9);opacity:0;transition:transform .2s ease,opacity .2s ease}.msg-actions-overlay.active .msg-actions-sheet{transform:scale(1);opacity:1}.msg-actions-preview{padding:16px;background:var(--chat-bg);border-bottom:1px solid var(--chat-border);font-size:.85rem;color:var(--chat-text-muted);max-height:80px;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical}.msg-action-btn{display:flex;align-items:center;gap:12px;width:100%;padding:16px;border:none;background:0 0;color:var(--chat-text);font-size:1rem;text-align:left;cursor:pointer;border-bottom:1px solid var(--chat-border)}.msg-action-btn:last-child{border-bottom:none}.msg-action-btn:active{background:var(--chat-bg)}.msg-action-btn.delete{color:#ef4444}.msg-action-btn i{width:20px;text-align:center}.msg-delete-confirm{padding:20px;text-align:center}.msg-delete-confirm p{margin:0 0 16px;color:var(--chat-text)}.msg-delete-actions{display:flex;gap:12px}.msg-delete-actions button{flex:1;padding:12px;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer;border:none}.msg-delete-cancel{background:var(--chat-bg);color:var(--chat-text)}.msg-delete-confirm-btn{background:#ef4444;color:#fff}.chat-bubble.selected{outline:2px solid var(--chat-primary);outline-offset:2px}.chat-bubble-actions{position:absolute;top:-40px;display:flex;align-items:center;gap:2px;padding:4px 6px;background:var(--chat-surface);border-radius:20px;box-shadow:0 2px 12px rgba(0,0,0,.15);border:1px solid var(--chat-border);opacity:0;visibility:hidden;transition:all .2s ease;z-index:20}.chat-bubble.sent .chat-bubble-actions{right:0}.chat-bubble.received .chat-bubble-actions{left:0}.chat-bubble-action-btn{width:32px;height:32px;border-radius:50%;border:none;background:0 0;color:var(--chat-text-muted);font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s ease}.chat-bubble-action-btn:hover{background:rgba(99,102,241,.1);transform:scale(1.15)}.chat-bubble-action-btn.menu-btn{font-size:.85rem;color:var(--chat-text-muted)}.chat-bubble-action-btn.menu-btn:hover{background:var(--chat-primary);color:#fff}@media (hover:hover){.chat-bubble{position:relative}.chat-bubble:hover .chat-bubble-actions{opacity:1;visibility:visible}}.chat-bubble.show-actions .chat-bubble-actions{opacity:1;visibility:visible}.chat-hint{text-align:center;padding:8px 16px;font-size:.75rem;color:var(--chat-text-muted);opacity:.7}.chat-hint i{margin-right:4px}@media (hover:hover){.chat-hint{display:none}}.chat-bubble-reactions{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px}.chat-reaction{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:12px;font-size:.8rem;cursor:pointer;transition:all .15s ease;border:1px solid transparent}.chat-bubble.sent .chat-reaction{background:rgba(255,255,255,.2);color:#fff}.chat-bubble.sent .chat-reaction:hover{background:rgba(255,255,255,.3)}.chat-bubble.received .chat-reaction{background:rgba(99,102,241,.1);color:var(--chat-text)}.chat-bubble.received .chat-reaction:hover{background:rgba(99,102,241,.2)}.chat-reaction.mine{border-color:var(--chat-primary)}.chat-reaction-emoji{font-size:.95rem;line-height:1}.chat-reaction-count{font-size:.7rem;font-weight:600;min-width:8px;text-align:center}.quick-reactions{position:absolute;bottom:calc(100% + 8px);display:flex;gap:2px;padding:6px 8px;background:var(--chat-surface);border-radius:24px;box-shadow:0 4px 20px rgba(0,0,0,.15);border:1px solid var(--chat-border);opacity:0;visibility:hidden;transform:translateY(8px) scale(.9);transition:all .2s cubic-bezier(.175, .885, .32, 1.275);z-index:50}.chat-bubble.sent .quick-reactions{right:0}.chat-bubble.received .quick-reactions{left:0}.chat-bubble.show-reactions .quick-reactions{opacity:1;visibility:visible;transform:translateY(0) scale(1)}.quick-reaction-btn{width:40px;height:40px;border:none;background:0 0;border-radius:50%;font-size:1.4rem;cursor:pointer;transition:all .15s ease;display:flex;align-items:center;justify-content:center}.quick-reaction-btn:hover{background:rgba(99,102,241,.1);transform:scale(1.2)}.quick-reaction-btn:active{transform:scale(.9)}.quick-reaction-btn.selected{background:var(--chat-primary);color:#fff}.msg-reactions-row{display:flex;justify-content:center;gap:4px;padding:12px 16px;border-bottom:1px solid var(--chat-border);background:var(--chat-bg)}.msg-reaction-pick{width:44px;height:44px;border:none;background:0 0;border-radius:50%;font-size:1.5rem;cursor:pointer;transition:all .15s ease;display:flex;align-items:center;justify-content:center}.msg-reaction-pick:hover{background:rgba(99,102,241,.15);transform:scale(1.15)}.msg-reaction-pick:active{transform:scale(.95)}.msg-reaction-pick.selected{background:var(--chat-primary)}.msg-toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(20px);background:#1e293b;color:#fff;padding:12px 20px;border-radius:8px;font-size:.9rem;z-index:100015;opacity:0;transition:opacity .3s,transform .3s;pointer-events:none}.msg-toast.show{opacity:1;transform:translateX(-50%) translateY(0)}[data-theme=dark] .msg-toast{background:#475569}