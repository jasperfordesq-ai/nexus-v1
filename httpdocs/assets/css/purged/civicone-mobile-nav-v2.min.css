/**
 * CivicOne Mobile Navigation v2
 * GOV.UK Frontend compliant mobile navigation
 *
 * Source of Truth: https://github.com/alphagov/govuk-frontend
 * - Colours: packages/govuk-frontend/src/govuk/settings/_colours-palette.scss
 * - Spacing: packages/govuk-frontend/src/govuk/settings/_spacing.scss
 *
 * This file is COMPLETELY ISOLATED from Modern theme.
 * No dependency on nexus-native-nav-v2.css
 *
 * GOV.UK Colour Reference:
 * - Blue primary: #1d70b8
 * - Blue tint-95 (light bg): #f4f8fb
 * - Black primary: #0b0c0c
 * - Black tint-25: #484949
 * - Black tint-50: #858686
 * - Black tint-80: #cecece
 * - Black tint-95: #f3f3f3
 * - White: #ffffff
 * - Focus: #ffdd00
 *
 * GOV.UK Spacing Scale:
 * - 1: 5px
 * - 2: 10px
 * - 3: 15px
 * - 4: 20px
 * - 5: 25px
 * - 6: 30px
 */

/* ============================================
   CSS VARIABLES - GOV.UK Design Tokens
   ============================================ */
:root {
    /* GOV.UK Colours */
    --govuk-blue: #1d70b8;
    --govuk-blue-tint-95: #f4f8fb;
    --govuk-black: #0b0c0c;
    --govuk-black-tint-25: #484949;
    --govuk-black-tint-50: #858686;
    --govuk-black-tint-80: #cecece;
    --govuk-black-tint-95: #f3f3f3;
    --govuk-white: #ffffff;
    --govuk-focus: #ffdd00;
    --govuk-focus-text: #0b0c0c;
    --govuk-border: #b1b4b6;
    --govuk-red: #d4351c;

    /* GOV.UK Spacing */
    --govuk-space-1: 5px;
    --govuk-space-2: 10px;
    --govuk-space-3: 15px;
    --govuk-space-4: 20px;
    --govuk-space-6: 30px;

    /* Mobile Navigation Specific */
    --civicone-mobile-nav-height: 64px;
    --civicone-mobile-nav-bg: var(--govuk-white);
    --civicone-mobile-nav-border: var(--govuk-border);
    --civicone-mobile-nav-text: var(--govuk-black-tint-50);
    --civicone-mobile-nav-active: var(--govuk-blue);

    /* Safe Areas (iOS notch) */
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --safe-top: env(safe-area-inset-top, 0px);
}

/* ============================================
   CRITICAL: Hide mobile navigation on desktop
   Maximum specificity to ensure hiding
   ============================================ */
@media (min-width: 1025px) {
    body .civicone-mobile-nav,
    body .civicone-mobile-menu,
    body .civicone-mobile-notifications,
    body .mobile-tab-bar,
    body .mobile-fullscreen-menu,
    body .mobile-notification-sheet,
    body #mobileMenu,
    body #mobileNotifications,
    body #mobileTabBar,
    html body .civicone-mobile-nav,
    html body .civicone-mobile-menu,
    html body .civicone-mobile-notifications,
    html body .mobile-tab-bar,
    html body .mobile-fullscreen-menu,
    html body .mobile-notification-sheet,
    html body #mobileMenu,
    html body #mobileNotifications,
    html body #mobileTabBar {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        pointer-events: none !important;
        position: absolute !important;
        left: -99999px !important;
        top: -99999px !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        clip: rect(0, 0, 0, 0) !important;
        z-index: -9999 !important;
    }
}

/* Hide on desktop by default (fallback) */
.mobile-tab-bar,
.mobile-fullscreen-menu,
.mobile-notification-sheet {
    display: none;
}

/* ============================================
   HIDE LEGACY NAVIGATION ON MOBILE
   ============================================ */
@media (max-width: 1024px) {
    .nexus-native-nav,
    .nexus-native-nav-inner,
    .nexus-bottom-nav,
    .nexus-quick-fab,
    .nexus-native-drawer,
    .nexus-native-drawer-overlay,
    .nexus-edge-indicator {
        display: none !important;
        visibility: hidden !important;
        pointer-events: none !important;
    }

    /* Hide header hamburger - we have Menu in bottom tab bar */
    .nexus-menu-btn,
    #civic-menu-toggle {
        display: none !important;
    }
}

/* ============================================
   1. BOTTOM TAB BAR
   GOV.UK inspired, WCAG 2.1 AA compliant
   ============================================ */
@media (max-width: 1024px) {
    .mobile-tab-bar {
        display: flex !important;
        visibility: visible !important;
        opacity: 1 !important;
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 99999 !important;
        height: calc(var(--civicone-mobile-nav-height) + var(--safe-bottom)) !important;
        padding-bottom: var(--safe-bottom) !important;
        background: var(--civicone-mobile-nav-bg) !important;
        border-top: 1px solid var(--civicone-mobile-nav-border) !important;
        box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.05);
    }

    /* Add body padding for tab bar */
    body {
        padding-bottom: calc(var(--civicone-mobile-nav-height) + var(--safe-bottom) + 6px) !important;
    }
}

.mobile-tab-bar-inner {
    display: flex;
    justify-content: space-around;
    align-items: center;
    height: var(--civicone-mobile-nav-height);
    max-width: 500px;
    margin: 0 auto;
    width: 100%;
    padding: 0 var(--govuk-space-2);
}

/* Tab Items - GOV.UK compliant */
.mobile-tab-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--govuk-space-1);
    flex: 1;
    min-width: 56px;
    max-width: 72px;
    height: 100%;
    text-decoration: none;
    color: var(--civicone-mobile-nav-text);
    font-size: 11px;
    font-weight: 400;
    font-family: "GDS Transport", arial, sans-serif;
    letter-spacing: 0;
    position: relative;
    -webkit-tap-highlight-color: transparent;
    transition: color 0.15s ease-in-out;
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--govuk-space-2) 0;
}

/* Button reset for menu button */
button.mobile-tab-item,
.mobile-tab-item[type="button"] {
    background: none;
    border: none;
    outline: none;
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
}

/* Icons */
.mobile-tab-item i,
.mobile-tab-item svg {
    font-size: 22px;
    line-height: 1;
    width: 24px;
    height: 24px;
}

.mobile-tab-item svg.create-icon {
    width: 28px;
    height: 28px;
}

/* Active state - GOV.UK blue */
.mobile-tab-item.active {
    color: var(--civicone-mobile-nav-active);
    font-weight: 700;
}

/* Focus state - GOV.UK focus indicator */
.mobile-tab-item:focus {
    outline: 3px solid var(--govuk-focus);
    outline-offset: 0;
    background-color: var(--govuk-focus);
    color: var(--govuk-focus-text);
}

.mobile-tab-item:focus:not(:focus-visible) {
    outline: none;
    background-color: transparent;
    color: var(--civicone-mobile-nav-text);
}

.mobile-tab-item:focus-visible {
    outline: 3px solid var(--govuk-focus);
    outline-offset: 0;
    background-color: var(--govuk-focus);
    color: var(--govuk-focus-text);
}

.mobile-tab-item.active:focus,
.mobile-tab-item.active:focus-visible {
    color: var(--govuk-focus-text);
}

/* Hover state */
.mobile-tab-item:hover:not(:focus) {
    color: var(--govuk-black);
}

/* Active tap feedback */
.mobile-tab-item:active {
    transform: scale(0.95);
}

/* Badge for notifications/messages */
.mobile-tab-badge {
    position: absolute;
    top: 6px;
    right: 50%;
    transform: translateX(14px);
    min-width: 18px;
    height: 18px;
    padding: 0 5px;
    background: var(--govuk-red);
    color: var(--govuk-white);
    font-size: 11px;
    font-weight: 700;
    line-height: 18px;
    text-align: center;
    border-radius: 9px;
}

/* ============================================
   2. FULLSCREEN MENU
   GOV.UK styled slide-in menu
   ============================================ */
.mobile-fullscreen-menu {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    max-width: 400px;
    z-index: 100000;
    background: var(--govuk-white);
    transform: translateX(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
}

@media (max-width: 1024px) {
    .mobile-fullscreen-menu {
        /* CRITICAL: Must be flex for scroll to work - menu-body needs flex: 1 */
        display: flex !important;
        flex-direction: column !important;
        visibility: visible !important;
        opacity: 1 !important;
        pointer-events: auto !important;
    }

    .mobile-fullscreen-menu:not(.active) {
        transform: translateX(100%);
        pointer-events: none;
    }

    .mobile-fullscreen-menu.active {
        transform: translateX(0);
        pointer-events: auto;
    }
}

/* Menu Header - GOV.UK blue */
.mobile-menu-header {
    position: relative;
    padding: var(--govuk-space-4);
    padding-top: calc(var(--govuk-space-4) + var(--safe-top));
    background: var(--govuk-blue);
    color: var(--govuk-white);
}

.mobile-menu-header-bg {
    display: none; /* No gradient in GOV.UK style */
}

.mobile-menu-close {
    position: absolute;
    top: calc(var(--govuk-space-3) + var(--safe-top));
    right: var(--govuk-space-3);
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    color: var(--govuk-white);
    font-size: 24px;
    cursor: pointer;
    border-radius: 0;
}

.mobile-menu-close:focus {
    outline: 3px solid var(--govuk-focus);
    outline-offset: 0;
    background: var(--govuk-focus);
    color: var(--govuk-focus-text);
}

/* User Info in Header */
.mobile-menu-user {
    display: flex;
    align-items: center;
    gap: var(--govuk-space-3);
    text-decoration: none;
    color: var(--govuk-white);
    margin-top: var(--govuk-space-2);
}

.mobile-menu-avatar-wrapper {
    position: relative;
    flex-shrink: 0;
}

.mobile-menu-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.mobile-menu-avatar-guest {
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.2);
    color: var(--govuk-white);
    font-size: 20px;
}

.mobile-menu-avatar-ring {
    display: none; /* No decorative ring in GOV.UK style */
}

.mobile-menu-user-info h3 {
    margin: 0;
    font-size: 19px;
    font-weight: 700;
    font-family: "GDS Transport", arial, sans-serif;
    line-height: 1.25;
}

.mobile-menu-user-info p {
    margin: var(--govuk-space-1) 0 0 0;
    font-size: 16px;
    opacity: 0.9;
}

.mobile-menu-user-arrow {
    margin-right: var(--govuk-space-1);
}

/* Quick Stats */
.mobile-menu-stats {
    display: flex;
    gap: var(--govuk-space-1);
    padding: var(--govuk-space-3) var(--govuk-space-4);
    background: var(--govuk-black-tint-95);
    border-bottom: 1px solid var(--govuk-border);
}

.mobile-menu-stat {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--govuk-space-2);
    text-decoration: none;
    color: var(--govuk-black);
    border-radius: 0;
    transition: background-color 0.15s;
}

.mobile-menu-stat:hover {
    background: var(--govuk-black-tint-80);
}

.mobile-menu-stat:focus {
    outline: 3px solid var(--govuk-focus);
    outline-offset: 0;
    background: var(--govuk-focus);
}

.mobile-menu-stat-value {
    font-size: 24px;
    font-weight: 700;
    font-family: "GDS Transport", arial, sans-serif;
    line-height: 1;
    color: var(--govuk-blue);
}

.mobile-menu-stat-label {
    font-size: 14px;
    color: var(--govuk-black-tint-25);
    margin-top: var(--govuk-space-1);
}

/* Menu Body */
.mobile-menu-body {
    padding: var(--govuk-space-3) 0;
}

/* Menu Sections */
.mobile-menu-section {
    padding: var(--govuk-space-2) 0;
}

.mobile-menu-section-title {
    padding: var(--govuk-space-2) var(--govuk-space-4);
    font-size: 14px;
    font-weight: 700;
    color: var(--govuk-black-tint-25);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-family: "GDS Transport", arial, sans-serif;
}

.mobile-menu-section-admin {
    border-top: 2px solid var(--govuk-border);
    margin-top: var(--govuk-space-2);
    padding-top: var(--govuk-space-3);
}

/* Menu Items - GOV.UK link style */
.mobile-menu-item {
    display: flex;
    align-items: center;
    gap: var(--govuk-space-3);
    padding: var(--govuk-space-3) var(--govuk-space-4);
    text-decoration: none;
    color: var(--govuk-blue);
    font-size: 19px;
    font-family: "GDS Transport", arial, sans-serif;
    transition: background-color 0.15s;
}

.mobile-menu-item:hover {
    background: var(--govuk-black-tint-95);
    text-decoration: underline;
    text-decoration-thickness: max(1px, .0625rem);
    text-underline-offset: .1em;
}

.mobile-menu-item:focus {
    outline: 3px solid var(--govuk-focus);
    outline-offset: 0;
    background: var(--govuk-focus);
    color: var(--govuk-focus-text);
    text-decoration: none;
}

.mobile-menu-item i {
    width: 24px;
    text-align: center;
    color: var(--govuk-black-tint-50);
    font-size: 18px;
}

.mobile-menu-item:hover i,
.mobile-menu-item:focus i {
    color: inherit;
}

/* AI Chat item - special styling */
.mobile-menu-item-ai {
    background: var(--govuk-blue-tint-95);
}

/* Menu Footer */
.mobile-menu-footer {
    display: flex;
    gap: var(--govuk-space-2);
    padding: var(--govuk-space-4);
    border-top: 1px solid var(--govuk-border);
    margin-top: var(--govuk-space-3);
}

.mobile-menu-footer-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--govuk-space-2);
    padding: var(--govuk-space-2) var(--govuk-space-3);
    background: var(--govuk-black-tint-95);
    border: none;
    color: var(--govuk-black);
    font-size: 16px;
    font-family: "GDS Transport", arial, sans-serif;
    cursor: pointer;
    text-decoration: none;
    border-radius: 0;
}

.mobile-menu-footer-btn:hover {
    background: var(--govuk-black-tint-80);
}

.mobile-menu-footer-btn:focus {
    outline: 3px solid var(--govuk-focus);
    outline-offset: 0;
    background: var(--govuk-focus);
    color: var(--govuk-focus-text);
}

.mobile-menu-footer-btn.danger {
    background: var(--govuk-red);
    color: var(--govuk-white);
}

.mobile-menu-footer-btn.danger:hover {
    background: #aa2a17;
}

/* ============================================
   3. NOTIFICATION SHEET
   Bottom sheet for notifications
   ============================================ */
.mobile-notification-sheet {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    max-height: 85vh;
    z-index: 100001;
    background: var(--govuk-white);
    border-radius: 16px 16px 0 0;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
}

@media (max-width: 1024px) {
    .mobile-notification-sheet {
        display: block !important;
        visibility: visible !important;
    }

    .mobile-notification-sheet:not(.active) {
        transform: translateY(100%);
        pointer-events: none;
    }

    .mobile-notification-sheet.active {
        transform: translateY(0);
        pointer-events: auto;
    }
}

/* Notification Backdrop */
.mobile-notification-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 100000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
}

.mobile-notification-backdrop.active {
    opacity: 1;
    visibility: visible;
}

/* Handle for dragging */
.mobile-notification-handle {
    display: flex;
    justify-content: center;
    padding: var(--govuk-space-2) 0;
}

.mobile-notification-handle::after {
    content: "";
    width: 36px;
    height: 4px;
    background: var(--govuk-black-tint-80);
    border-radius: 2px;
}

/* Notification Header */
.mobile-notification-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--govuk-space-3) var(--govuk-space-4);
    border-bottom: 1px solid var(--govuk-border);
}

.mobile-notification-title {
    font-size: 19px;
    font-weight: 700;
    font-family: "GDS Transport", arial, sans-serif;
    color: var(--govuk-black);
    margin: 0;
}

.mobile-notification-actions {
    display: flex;
    gap: var(--govuk-space-2);
}

.mobile-notification-action {
    padding: var(--govuk-space-1) var(--govuk-space-2);
    background: none;
    border: none;
    color: var(--govuk-blue);
    font-size: 14px;
    font-family: "GDS Transport", arial, sans-serif;
    cursor: pointer;
    text-decoration: underline;
}

.mobile-notification-action:focus {
    outline: 3px solid var(--govuk-focus);
    outline-offset: 0;
    background: var(--govuk-focus);
    color: var(--govuk-focus-text);
    text-decoration: none;
}

/* Notification Container */
.mobile-notification-container {
    max-height: calc(85vh - 100px);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
    padding-bottom: calc(var(--govuk-space-4) + var(--safe-bottom));
}

/* Notification List */
.mobile-notification-list {
    list-style: none;
    margin: 0;
    padding: 0;
}

/* Notification Items */
.mobile-notification-item {
    display: flex;
    gap: var(--govuk-space-3);
    padding: var(--govuk-space-3) var(--govuk-space-4);
    border-bottom: 1px solid var(--govuk-black-tint-95);
    text-decoration: none;
    color: var(--govuk-black);
}

.mobile-notification-item:hover {
    background: var(--govuk-black-tint-95);
}

.mobile-notification-item:focus {
    outline: 3px solid var(--govuk-focus);
    outline-offset: -3px;
    background: var(--govuk-focus);
}

.mobile-notification-item.unread {
    background: var(--govuk-blue-tint-95);
}

.mobile-notification-item.unread:hover {
    background: #e8f0f8;
}

.mobile-notification-dot {
    flex-shrink: 0;
    width: 8px;
    height: 8px;
    margin-top: 6px;
    background: var(--govuk-blue);
    border-radius: 50%;
}

.mobile-notification-content {
    flex: 1;
    min-width: 0;
}

.mobile-notification-message {
    font-size: 16px;
    font-family: "GDS Transport", arial, sans-serif;
    line-height: 1.4;
    margin: 0;
    color: var(--govuk-black);
}

.mobile-notification-time {
    font-size: 14px;
    color: var(--govuk-black-tint-50);
    margin-top: var(--govuk-space-1);
}

/* Empty State */
.mobile-notification-empty {
    padding: var(--govuk-space-6) var(--govuk-space-4);
    text-align: center;
}

.mobile-notification-empty i {
    font-size: 48px;
    color: var(--govuk-black-tint-80);
    margin-bottom: var(--govuk-space-3);
}

.mobile-notification-empty p {
    font-size: 16px;
    color: var(--govuk-black-tint-50);
    margin: 0;
}

/* ============================================
   4. BODY SCROLL LOCK
   NOTE: Do NOT use position: fixed - it breaks scroll inside menu on iOS
   ============================================ */
body.mobile-menu-open,
body.menu-open {
    overflow: hidden !important;
    touch-action: none;
}

/* ============================================
   5. THEME TOGGLE (GOV.UK doesn't have dark mode,
   but we support it for user preference)
   ============================================ */
.theme-toggle-icon {
    transition: transform 0.3s;
}

.theme-toggle-inline {
    background: var(--govuk-black-tint-95);
}

/* ============================================
   6. FIX: Remove transform that breaks position:fixed
   ============================================ */
html[data-layout] {
    transform: none !important;
}

/* ============================================
   7. PRINT STYLES - Hide mobile nav
   ============================================ */
@media print {
    .mobile-tab-bar,
    .mobile-fullscreen-menu,
    .mobile-notification-sheet,
    .mobile-notification-backdrop {
        display: none !important;
    }
}
