/**
 * Avatar/Image Placeholders
 * Gradient shimmer while loading, smooth fade-in on load
 * Version: 1.1 - 2026-01-21 - Migrated to design tokens
 *
 * Features:
 * - Animated gradient shimmer effect
 * - Multiple placeholder sizes
 * - Smooth fade-in when loaded
 * - Initials fallback styling
 * - Dark mode support
 */

/* ==========================================================================
   Shimmer Animation
   ========================================================================== */

@keyframes avatar-shimmer {
    0% {
        background-position: -200% 0;
    }
    100% {
        background-position: 200% 0;
    }
}

@keyframes avatar-fade-in {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes avatar-pulse {
    0%, 100% {
        opacity: 0.6;
    }
    50% {
        opacity: 1;
    }
}

/* ==========================================================================
   Base Avatar Placeholder
   ========================================================================== */

.avatar-placeholder,
.image-placeholder,
[data-placeholder="avatar"],
[data-placeholder="image"] {
    position: relative;
    background: linear-gradient(
        90deg,
        var(--color-gray-200) 0%,
        var(--color-gray-100) 25%,
        var(--color-gray-200) 50%,
        var(--color-gray-100) 75%,
        var(--color-gray-200) 100%
    );
    background-size: 200% 100%;
    animation: avatar-shimmer 1.5s ease-in-out infinite;
    overflow: hidden;
}

/* Circular avatar placeholder */
.avatar-placeholder,
[data-placeholder="avatar"] {
    border-radius: var(--radius-full);
}

/* Rectangular image placeholder */
.image-placeholder,
[data-placeholder="image"] {
    border-radius: var(--radius-base);
}

/* ==========================================================================
   Avatar Sizes
   ========================================================================== */

/* Extra small - 24px */
.avatar-placeholder--xs,
.avatar-xs.avatar-placeholder {
    width: var(--space-6);
    height: var(--space-6);
}

/* Small - 32px */
.avatar-placeholder--sm,
.avatar-sm.avatar-placeholder {
    width: var(--space-8);
    height: var(--space-8);
}

/* Medium (default) - 40px */
.avatar-placeholder--md,
.avatar-md.avatar-placeholder,
.avatar-placeholder {
    width: var(--space-10);
    height: var(--space-10);
}

/* Large - 56px */
.avatar-placeholder--lg,
.avatar-lg.avatar-placeholder {
    width: 56px;
    height: 56px;
}

/* Extra large - 80px */
.avatar-placeholder--xl,
.avatar-xl.avatar-placeholder {
    width: var(--space-20);
    height: var(--space-20);
}

/* Profile header - 120px */
.avatar-placeholder--profile,
.avatar-profile.avatar-placeholder {
    width: 120px;
    height: 120px;
}

/* ==========================================================================
   Image Placeholder Sizes
   ========================================================================== */

/* Card thumbnail */
.image-placeholder--card {
    width: 100%;
    height: 180px;
}

/* Post image */
.image-placeholder--post {
    width: 100%;
    height: 300px;
}

/* Gallery thumbnail */
.image-placeholder--thumb {
    width: 100%;
    height: 120px;
}

/* Full width banner */
.image-placeholder--banner {
    width: 100%;
    height: 200px;
}

/* Square aspect ratio */
.image-placeholder--square {
    width: 100%;
    padding-top: 100%;
    height: 0;
}

/* 16:9 aspect ratio */
.image-placeholder--video {
    width: 100%;
    padding-top: 56.25%;
    height: 0;
}

/* ==========================================================================
   Loaded State - Fade In
   ========================================================================== */

/* When image loads, fade it in */
.avatar-loaded,
.image-loaded,
[data-loaded="true"] {
    animation: avatar-fade-in var(--transition-base) ease-out forwards;
}

/* Remove shimmer when loaded */
.avatar-placeholder.avatar-loaded,
.image-placeholder.image-loaded,
[data-placeholder].loaded {
    animation: none;
    background: transparent;
}

/* Image inside placeholder container */
.avatar-placeholder img,
.image-placeholder img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    transition: opacity var(--transition-base) ease;
}

.avatar-placeholder.loaded img,
.image-placeholder.loaded img,
.avatar-placeholder img.loaded,
.image-placeholder img.loaded {
    opacity: 1;
}

/* ==========================================================================
   Initials Fallback
   ========================================================================== */

.avatar-initials {
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: var(--font-weight-semibold);
    text-transform: uppercase;
    color: white;
    border-radius: var(--radius-full);
    user-select: none;
}

/* Initials sizes */
.avatar-initials--xs { width: var(--space-6); height: var(--space-6); font-size: 10px; }
.avatar-initials--sm { width: var(--space-8); height: var(--space-8); font-size: var(--font-size-xs); }
.avatar-initials--md { width: var(--space-10); height: var(--space-10); font-size: var(--font-size-sm); }
.avatar-initials--lg { width: 56px; height: 56px; font-size: var(--font-size-lg); }
.avatar-initials--xl { width: var(--space-20); height: var(--space-20); font-size: var(--font-size-2xl); }
.avatar-initials--profile { width: 120px; height: 120px; font-size: var(--font-size-4xl); }

/* Gradient backgrounds for initials */
.avatar-initials[data-color="1"],
.avatar-initials--blue { background: linear-gradient(135deg, var(--color-blue-500), var(--color-blue-700)); }

.avatar-initials[data-color="2"],
.avatar-initials--purple { background: linear-gradient(135deg, var(--color-purple-500), #6d28d9); }

.avatar-initials[data-color="3"],
.avatar-initials--pink { background: linear-gradient(135deg, var(--color-pink-500), var(--color-pink-700)); }

.avatar-initials[data-color="4"],
.avatar-initials--green { background: linear-gradient(135deg, var(--color-green-500), var(--color-green-700)); }

.avatar-initials[data-color="5"],
.avatar-initials--orange { background: linear-gradient(135deg, var(--color-orange-500), var(--color-amber-600)); }

.avatar-initials[data-color="6"],
.avatar-initials--teal { background: linear-gradient(135deg, #14b8a6, #0d9488); }

.avatar-initials[data-color="7"],
.avatar-initials--red { background: linear-gradient(135deg, var(--color-red-500), var(--color-red-600)); }

.avatar-initials[data-color="8"],
.avatar-initials--indigo { background: linear-gradient(135deg, var(--color-primary-500), var(--color-primary-600)); }

/* Default gradient */
.avatar-initials {
    background: linear-gradient(135deg, var(--color-primary-500), var(--color-purple-500));
}

/* ==========================================================================
   Error State - Broken Image
   ========================================================================== */

.avatar-error,
.image-error,
[data-error="true"] {
    background: linear-gradient(135deg, var(--color-gray-100), var(--color-gray-200));
    animation: none;
}

.avatar-error::after,
.image-error::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40%;
    height: 40%;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Ccircle cx='8.5' cy='8.5' r='1.5'%3E%3C/circle%3E%3Cpolyline points='21,15 16,10 5,21'%3E%3C/polyline%3E%3C/svg%3E");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    opacity: 0.5;
}

/* User icon for broken avatar */
.avatar-error::after {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'%3E%3C/path%3E%3Ccircle cx='12' cy='7' r='4'%3E%3C/circle%3E%3C/svg%3E");
}

/* ==========================================================================
   Avatar Group (Overlapping)
   ========================================================================== */

.avatar-group {
    display: flex;
    flex-direction: row-reverse;
    justify-content: flex-end;
}

.avatar-group > * {
    margin-left: calc(var(--space-2) * -1);
    border: 2px solid white;
    box-shadow: var(--shadow-xs);
}

.avatar-group > *:last-child {
    margin-left: 0;
}

/* More count badge */
.avatar-group-more {
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-gray-200);
    color: var(--color-gray-500);
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-semibold);
    border-radius: var(--radius-full);
}

/* ==========================================================================
   Skeleton Variants
   ========================================================================== */

/* Text line skeleton */
.skeleton-text {
    height: 1em;
    border-radius: var(--radius-sm);
    background: linear-gradient(
        90deg,
        var(--color-gray-200) 0%,
        var(--color-gray-100) 25%,
        var(--color-gray-200) 50%,
        var(--color-gray-100) 75%,
        var(--color-gray-200) 100%
    );
    background-size: 200% 100%;
    animation: avatar-shimmer 1.5s ease-in-out infinite;
}

.skeleton-text--short { width: 60%; }
.skeleton-text--medium { width: 80%; }
.skeleton-text--full { width: 100%; }

/* Button skeleton */
.skeleton-button {
    height: var(--space-10);
    border-radius: var(--radius-base);
    background: linear-gradient(
        90deg,
        var(--color-gray-200) 0%,
        var(--color-gray-100) 25%,
        var(--color-gray-200) 50%,
        var(--color-gray-100) 75%,
        var(--color-gray-200) 100%
    );
    background-size: 200% 100%;
    animation: avatar-shimmer 1.5s ease-in-out infinite;
}

/* ==========================================================================
   Dark Mode
   ========================================================================== */

[data-theme="dark"] .avatar-placeholder,
[data-theme="dark"] .image-placeholder,
[data-theme="dark"] [data-placeholder="avatar"],
[data-theme="dark"] [data-placeholder="image"] {
    background: linear-gradient(
        90deg,
        var(--color-gray-700) 0%,
        var(--color-gray-600) 25%,
        var(--color-gray-700) 50%,
        var(--color-gray-600) 75%,
        var(--color-gray-700) 100%
    );
    background-size: 200% 100%;
}

[data-theme="dark"] .avatar-error,
[data-theme="dark"] .image-error {
    background: linear-gradient(135deg, var(--color-gray-700), var(--color-gray-800));
}

[data-theme="dark"] .avatar-error::after,
[data-theme="dark"] .image-error::after {
    filter: brightness(0.7);
}

[data-theme="dark"] .avatar-group > * {
    border-color: var(--color-gray-800);
}

[data-theme="dark"] .avatar-group-more {
    background: var(--color-gray-700);
    color: var(--color-gray-400);
}

[data-theme="dark"] .skeleton-text,
[data-theme="dark"] .skeleton-button {
    background: linear-gradient(
        90deg,
        var(--color-gray-700) 0%,
        var(--color-gray-600) 25%,
        var(--color-gray-700) 50%,
        var(--color-gray-600) 75%,
        var(--color-gray-700) 100%
    );
    background-size: 200% 100%;
}

/* ==========================================================================
   Reduced Motion
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
    .avatar-placeholder,
    .image-placeholder,
    [data-placeholder="avatar"],
    [data-placeholder="image"],
    .skeleton-text,
    .skeleton-button {
        animation: avatar-pulse 2s ease-in-out infinite;
    }

    .avatar-loaded,
    .image-loaded,
    [data-loaded="true"] {
        animation: none;
        opacity: 1;
        transform: none;
    }
}

/* ==========================================================================
   Integration with Existing Classes
   ========================================================================== */

/* Apply shimmer to common avatar/image containers when loading */
.user-avatar.loading,
.profile-avatar.loading,
.member-avatar.loading {
    position: relative;
    overflow: hidden;
}

.user-avatar.loading::before,
.profile-avatar.loading::before,
.member-avatar.loading::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.4) 50%,
        transparent 100%
    );
    animation: avatar-shimmer 1.5s ease-in-out infinite;
    z-index: 1;
}

[data-theme="dark"] .user-avatar.loading::before,
[data-theme="dark"] .profile-avatar.loading::before,
[data-theme="dark"] .member-avatar.loading::before {
    background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.1) 50%,
        transparent 100%
    );
}
