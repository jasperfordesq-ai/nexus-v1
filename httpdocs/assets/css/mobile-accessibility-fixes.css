/**
 * Mobile Accessibility Fixes
 * WCAG 2.1 AAA compliance improvements
 * Fixes critical touch target size violations
 * Version: 1.1 - 2026-01-21 - Migrated to design tokens
 *
 * PRIORITY: CRITICAL
 * These fixes ensure all interactive elements meet 44x44px minimum touch target size
 */

/* ============================================
   TOUCH TARGET SIZE FIXES
   Ensure 44x44px minimum for all interactive elements
   ============================================ */

/* Mobile Sheets - Close Button (was 32x32px) */
@media (max-width: 768px) {
    .mobile-sheet-close {
        min-width: 44px;
        min-height: 44px;
        /* Maintain visual size with padding adjustment */
        padding: var(--space-1);
    }

    /* Comment Send Button (was 40x40px) */
    .mobile-comment-send {
        min-width: 44px;
        min-height: 44px;
    }

    /* Reply Send Button (was 32x32px) */
    .mobile-reply-send {
        min-width: 44px;
        min-height: 44px;
        /* Adjust font size to maintain proportion */
        font-size: var(--font-size-sm);
    }

    /* Comment Avatar - Add padding to increase tap zone */
    .mobile-comment-avatar {
        min-width: 44px;
        min-height: 44px;
        /* Use padding to maintain 36px visual size */
        padding: var(--space-1);
        box-sizing: content-box;
    }

    /* Nested Comment Avatar - Add padding */
    .mobile-comment-replies .mobile-comment-avatar {
        min-width: 44px;
        min-height: 44px;
        padding: var(--space-2);
        box-sizing: content-box;
    }
}

/* Mobile Search Overlay Fixes */
@media (max-width: 768px) {
    /* Back Button (was 40x40px) */
    .mobile-search-back {
        min-width: 44px;
        min-height: 44px;
    }

    /* Clear Button (was 28x28px) */
    .mobile-search-clear {
        min-width: 44px;
        min-height: 44px;
        /* Maintain icon size */
        padding: var(--space-2);
    }

    /* Cancel Button - Ensure adequate tap zone */
    .mobile-search-cancel {
        min-height: 44px;
        padding: var(--space-2) var(--space-3);
    }

    /* Search Tab Pills - Increase touch target */
    .mobile-search-tab {
        min-height: 44px;
        padding: var(--space-2) var(--space-4);
    }

    /* Tag Remove Button (was 32x32px) */
    .mobile-tag-remove,
    .mobile-search-tag-remove {
        min-width: 44px;
        min-height: 44px;
    }
}

/* Native Navigation Fixes */
@media (max-width: 1024px) {
    /* Menu Icon (was 40x40px) */
    .mobile-menu-icon-wrap,
    .nexus-menu-icon {
        min-width: 44px;
        min-height: 44px;
        /* Maintain visual icon size */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Tab Bar Avatars (was 26x26px) */
    .mobile-tab-avatar {
        min-width: 44px;
        min-height: 44px;
        /* Use padding to maintain visual size */
        padding: var(--space-2);
        box-sizing: content-box;
    }

    /* Badge Tap Zone - Ensure badges are tappable */
    .mobile-tab-badge,
    .nexus-tab-badge {
        min-width: 22px; /* Visual size */
        min-height: 22px;
        /* Add invisible padding for tap zone */
        position: relative;
    }

    .mobile-tab-badge::before,
    .nexus-tab-badge::before {
        content: '';
        position: absolute;
        top: -11px;
        left: -11px;
        right: -11px;
        bottom: -11px;
        /* Creates 44x44px tap zone */
        min-width: 44px;
        min-height: 44px;
    }

    /* Close Button - Ensure adequate size */
    .mobile-menu-close,
    .nexus-menu-close {
        min-width: 44px;
        min-height: 44px;
    }

    /* Notification Handle - Make draggable */
    .mobile-notification-handle {
        min-height: 44px; /* Increase draggable area */
        padding: var(--space-5) var(--space-0); /* Visual handle stays small, tap zone is large */
        cursor: grab;
    }

    .mobile-notification-handle:active {
        cursor: grabbing;
    }
}

/* ============================================
   GENERAL TOUCH TARGET IMPROVEMENTS
   Apply to any button-like element
   ============================================ */

@media (pointer: coarse) {
    /* All buttons and interactive elements */
    button:not(.mobile-touch-target-override),
    [role="button"]:not(.mobile-touch-target-override),
    a.btn:not(.mobile-touch-target-override),
    .mobile-interactive:not(.mobile-touch-target-override) {
        min-width: 44px;
        min-height: 44px;
    }

    /* Icon buttons specifically */
    .icon-btn,
    .btn-icon,
    button[aria-label]:not([aria-label=""]) {
        min-width: 44px;
        min-height: 44px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    /* Links in mobile context */
    .mobile-menu-item,
    .mobile-search-item {
        min-height: 44px;
        display: flex;
        align-items: center;
    }
}

/* ============================================
   VISUAL COMPENSATION
   Maintain visual appearance while increasing tap zones
   ============================================ */

/* Use pseudo-elements to expand tap zones without affecting visual layout */
.mobile-expand-tap-zone {
    position: relative;
}

.mobile-expand-tap-zone::before {
    content: '';
    position: absolute;
    top: calc(-1 * var(--space-2));
    right: calc(-1 * var(--space-2));
    bottom: calc(-1 * var(--space-2));
    left: calc(-1 * var(--space-2));
    /* Invisible tap zone expansion */
}

/* ============================================
   ACCESSIBILITY STATES
   Ensure focus and active states are visible
   ============================================ */

@media (max-width: 768px) {
    /* Enhanced focus for touch devices */
    button:focus-visible,
    [role="button"]:focus-visible,
    .mobile-interactive:focus-visible {
        outline: 3px solid var(--color-primary-500);
        outline-offset: 2px;
    }

    /* Active/pressed state feedback */
    button:active,
    [role="button"]:active,
    .mobile-interactive:active {
        transform: scale(0.96);
        opacity: 0.8;
        transition: var(--transition-fast);
    }
}

/* ============================================
   DRAG HANDLES
   Special treatment for drag-enabled elements
   ============================================ */

@media (max-width: 768px) {
    /* Sheet Drag Handle - Increase draggable area */
    .mobile-sheet-handle {
        /* Visual handle is 36x5px, but draggable area is much larger */
        padding: var(--space-5) var(--space-0);
        min-height: 44px;
        cursor: grab;
        /* Center the visual handle */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .mobile-sheet-handle::after {
        content: '';
        width: 36px;
        height: 5px;
        background: rgba(128, 128, 128, 0.3);
        border-radius: var(--radius-sm);
        pointer-events: none;
    }

    .mobile-sheet-handle:active {
        cursor: grabbing;
    }
}

/* ============================================
   OVERRIDE CLASS
   Use this class to explicitly opt-out of touch target fixes
   Use sparingly and only when absolutely necessary
   ============================================ */

.mobile-touch-target-override {
    /* Allows smaller elements when needed for design reasons */
    /* Example: Decorative elements, non-interactive badges */
}

/* ============================================
   TESTING HELPER
   Uncomment to visualize touch target zones
   ============================================ */

/*
@media (max-width: 768px) {
    button, [role="button"], .mobile-interactive {
        outline: 2px dashed red !important;
        outline-offset: -2px !important;
    }
}
*/
