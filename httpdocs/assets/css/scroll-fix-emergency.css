/**
 * EMERGENCY SCROLL FIX - NUCLEAR OPTION
 * Created: 2026-01-19
 *
 * This file MUST be loaded LAST to override all other CSS.
 * Uses maximum specificity + !important to force scrolling to work.
 *
 * ROOT CAUSE: Previous inline CSS set "overflow: visible !important" on body,
 * which breaks mouse wheel scrolling in some browsers. The correct value
 * for body is "overflow-y: auto" (not visible, not scroll).
 */

/* ===========================================
   NUCLEAR SCROLL FIX - HTML ELEMENT
   =========================================== */

/* Target html with every possible attribute combination */
html,
html:root,
html[lang],
html[data-theme],
html[data-layout],
html[data-theme="dark"],
html[data-theme="light"],
html[data-layout="modern"],
html[data-layout="civicone"],
html.content-loaded,
html.loading,
html.loaded,
html.scrolling {
    overflow-y: scroll !important;
    overflow-x: hidden !important;
    height: auto !important;
    max-height: none !important;
    position: static !important;
    /* Ensure scroll works */
    overscroll-behavior: auto !important;
    -webkit-overflow-scrolling: touch !important;
}

/* ===========================================
   NUCLEAR SCROLL FIX - BODY ELEMENT
   =========================================== */

/* Target body with every possible class combination */
body,
html body,
html[data-theme] body,
html[data-layout] body,
html[data-theme="dark"] body,
html[data-theme="light"] body,
html[data-layout="modern"] body,
html[data-layout="civicone"] body,
body.nexus-skin-modern,
body.nexus-home-page,
body.logged-in,
body.user-is-admin {
    overflow-y: auto !important;
    overflow-x: hidden !important;
    position: static !important;
    height: auto !important;
    max-height: none !important;
    /* DO NOT use overflow: visible - it breaks mouse wheel scroll */
    /* Ensure scroll works */
    overscroll-behavior-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
}

/* ===========================================
   MODAL/DRAWER STATES - Correctly lock scroll
   These classes should ONLY be applied via JS when modals are open
   =========================================== */

body.drawer-open,
body.modal-open,
body.fds-sheet-open,
body.mobile-menu-open,
body.mobile-notifications-open,
body.keyboard-open,
body.menu-open {
    overflow: hidden !important;
    overflow-y: hidden !important;
    /* CRITICAL: Override any position: fixed from other CSS - it breaks scroll inside panels */
    position: static !important;
    /* NOTE: Do NOT use touch-action:none - it blocks scroll inside menu panels */
}

/* ===========================================
   MOBILE MENU SCROLL FIX
   Ensure menu content can scroll when body is locked
   =========================================== */
.mobile-fullscreen-menu .mobile-menu-body,
#mobileMenu .mobile-menu-body {
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    touch-action: pan-y !important;
    min-height: 0 !important; /* Required for flexbox scroll */
}

/* ===========================================
   CHAT/MESSAGES PAGES - Exception
   These pages manage their own scroll containers
   =========================================== */

body.chat-page,
body.chat-fullscreen,
body.messages-fullscreen {
    /* Let these pages handle their own overflow */
    /* But ensure they're not accidentally applied to other pages */
}

/* ===========================================
   PULL-TO-REFRESH PREVENTION VIA CSS (2026-02-01)
   Replaces inline style.cssText manipulation which broke scroll
   =========================================== */
html.no-ptr,
body.no-ptr {
    overscroll-behavior-y: none !important;
    /* Keep normal scroll functioning */
    overflow-y: auto !important;
}

/* ===========================================
   PREVENT INVISIBLE OVERLAYS FROM BLOCKING SCROLL
   =========================================== */

/* Any fixed/absolute overlay without visible content should not block pointer events */
.edit-backdrop:not(.active):not(.visible):not(.show),
.onboarding-backdrop:not(.active):not(.visible):not(.show),
.modal-backdrop:not(.active):not(.visible):not(.show) {
    pointer-events: none !important;
    display: none !important;
}

/* ===========================================
   SIDEBAR POSITIONING FIX
   RESOLVED: Now properly handled in nexus-home.css (2026-01-25)
   The sidebar layout is consolidated in nexus-home.css with
   position: relative set directly on .home-sidebar-column
   =========================================== */

/* ===========================================
   FAILSAFE: Remove any wheel event blockers via CSS
   (This is a CSS hint, actual fix needs JS)
   =========================================== */

html,
body,
#app,
#root,
.app-container,
.page-container,
main,
.main-content {
    /* Ensure touch/wheel events pass through */
    touch-action: auto !important;
}

/* ===========================================
   NESTED SCROLL CONTAINER FIX (2026-02-01)

   Problem: Setting overflow-x:hidden on containers makes
   browsers auto-change overflow-y from visible to auto,
   creating scroll traps that block body scroll on mobile.

   Solution: Force overflow-y:visible on wrapper containers
   so scroll happens on body, not inside nested divs.
   =========================================== */

@media (max-width: 768px) {
    /* Content containers must NOT be scroll containers */
    .htb-container-full,
    #listings-index-glass-wrapper,
    #main-content,
    .main-content {
        overflow-y: visible !important;
        overflow-x: clip !important; /* clip prevents scroll without creating scroll container */
        max-width: 100vw !important;
    }

    /* Fallback for browsers that don't support overflow:clip */
    @supports not (overflow-x: clip) {
        .htb-container-full,
        #listings-index-glass-wrapper,
        #main-content,
        .main-content {
            overflow-x: hidden !important;
            overflow-y: visible !important;
        }
    }
}
