/**
 * Form Validation Animations
 * Shake on error, checkmark on success, smooth transitions
 * Version: 2.0 - 2026-01-21 - Migrated to design tokens
 *
 * Features:
 * - Shake animation for invalid fields
 * - Checkmark animation for valid fields
 * - Smooth border/shadow color transitions
 * - Error message slide-in
 * - Success state glow
 * - Dark mode support
 */

/* ==========================================================================
   Base Form Field States
   ========================================================================== */

/* Input/select/textarea base transition */
.form-control,
.form-input,
input[type="text"],
input[type="email"],
input[type="password"],
input[type="number"],
input[type="tel"],
input[type="url"],
input[type="search"],
input[type="date"],
input[type="time"],
input[type="datetime-local"],
select,
textarea {
    transition:
        border-color var(--transition-fast) var(--ease-out),
        box-shadow var(--transition-fast) var(--ease-out),
        background-color var(--transition-fast) var(--ease-out);
}

/* ==========================================================================
   Error State - Shake Animation
   ========================================================================== */

/* Shake keyframes */
@keyframes form-shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-6px); }
    20%, 40%, 60%, 80% { transform: translateX(6px); }
}

@keyframes form-shake-subtle {
    0%, 100% { transform: translateX(0); }
    25%, 75% { transform: translateX(-3px); }
    50% { transform: translateX(3px); }
}

/* Error state styling */
.is-invalid,
.form-error,
.has-error input,
.has-error select,
.has-error textarea,
input:invalid:not(:placeholder-shown),
select:invalid:not([data-placeholder]),
textarea:invalid:not(:placeholder-shown),
[data-validation="error"] {
    border-color: var(--color-danger) !important;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.15) !important;
}

/* Shake on focus after error */
.is-invalid:focus,
.form-error:focus,
.has-error input:focus,
[data-validation="error"]:focus {
    animation: form-shake var(--transition-slow) var(--ease-out);
}

/* Shake trigger class (for JS-triggered shake) */
.form-shake {
    animation: form-shake var(--transition-slow) var(--ease-out);
}

.form-shake-subtle {
    animation: form-shake-subtle var(--transition-base) var(--ease-out);
}

/* ==========================================================================
   Success State - Checkmark Animation
   ========================================================================== */

/* Checkmark keyframes */
@keyframes form-checkmark-draw {
    0% {
        stroke-dashoffset: 24;
        opacity: 0;
    }
    50% {
        opacity: 1;
    }
    100% {
        stroke-dashoffset: 0;
        opacity: 1;
    }
}

@keyframes form-success-pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
    }
    70% {
        box-shadow: 0 0 0 8px rgba(34, 197, 94, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
    }
}

/* Success state styling */
.is-valid,
.form-success,
.has-success input,
.has-success select,
.has-success textarea,
[data-validation="success"] {
    border-color: var(--color-success) !important;
    box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.15) !important;
}

/* Pulse on success */
.form-success-pulse {
    animation: form-success-pulse 0.6s var(--ease-out);
}

/* ==========================================================================
   Validation Icon Container
   ========================================================================== */

/* Wrapper for input + icon */
.form-validation-wrapper {
    position: relative;
    display: inline-block;
    width: 100%;
}

/* Validation icon positioning */
.form-validation-icon {
    position: absolute;
    right: var(--space-3);
    top: 50%;
    transform: translateY(-50%);
    width: var(--space-5);
    height: var(--space-5);
    opacity: 0;
    transition: opacity var(--transition-fast) var(--ease-out), transform var(--transition-fast) var(--ease-out);
    pointer-events: none;
}

/* Show icon when validation state is set */
.is-valid ~ .form-validation-icon,
.is-invalid ~ .form-validation-icon,
.form-success ~ .form-validation-icon,
.form-error ~ .form-validation-icon {
    opacity: 1;
}

/* Success checkmark */
.form-validation-icon--success {
    color: var(--color-success);
}

.form-validation-icon--success svg {
    stroke-dasharray: 24;
    stroke-dashoffset: 24;
}

.is-valid ~ .form-validation-icon--success svg,
.form-success ~ .form-validation-icon--success svg {
    animation: form-checkmark-draw 0.4s var(--ease-out) forwards;
}

/* Error X icon */
.form-validation-icon--error {
    color: var(--color-danger);
}

/* Make room for icon in input */
.form-validation-wrapper .form-control,
.form-validation-wrapper input {
    padding-right: var(--space-10);
}

/* ==========================================================================
   Error Message Animation
   ========================================================================== */

/* Error message keyframes */
@keyframes form-error-slide-in {
    from {
        opacity: 0;
        transform: translateY(-8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes form-error-fade-out {
    from {
        opacity: 1;
        transform: translateY(0);
    }
    to {
        opacity: 0;
        transform: translateY(-4px);
    }
}

/* Error message styling */
.form-error-message,
.invalid-feedback,
.error-message,
.field-error {
    color: var(--color-danger);
    font-size: var(--font-size-sm);
    margin-top: var(--space-1);
    display: block;
    animation: form-error-slide-in var(--transition-base) var(--ease-out);
}

/* Success message styling */
.form-success-message,
.valid-feedback,
.success-message {
    color: var(--color-success);
    font-size: var(--font-size-sm);
    margin-top: var(--space-1);
    display: block;
    animation: form-error-slide-in var(--transition-base) var(--ease-out);
}

/* Fade out class for removing messages */
.form-message-fade-out {
    animation: form-error-fade-out var(--transition-fast) var(--ease-out) forwards;
}

/* ==========================================================================
   Field Group Animation
   ========================================================================== */

/* Entire field group shake */
.form-group.has-error,
.field-group.has-error {
    animation: form-shake-subtle 0.4s var(--ease-out);
}

/* Label color change */
.form-group.has-error label,
.field-group.has-error label {
    color: var(--color-danger);
    transition: color var(--transition-fast) var(--ease-out);
}

.form-group.has-success label,
.field-group.has-success label {
    color: var(--color-success);
    transition: color var(--transition-fast) var(--ease-out);
}

/* ==========================================================================
   Password Strength Indicator
   ========================================================================== */

.password-strength {
    height: var(--space-1);
    background: var(--color-gray-200);
    border-radius: var(--radius-sm);
    margin-top: var(--space-2);
    overflow: hidden;
}

.password-strength-bar {
    height: 100%;
    width: 0;
    border-radius: var(--radius-sm);
    transition: width var(--transition-base) var(--ease-out), background-color var(--transition-base) var(--ease-out);
}

.password-strength[data-strength="weak"] .password-strength-bar {
    width: 25%;
    background: var(--color-danger);
}

.password-strength[data-strength="fair"] .password-strength-bar {
    width: 50%;
    background: var(--color-warning);
}

.password-strength[data-strength="good"] .password-strength-bar {
    width: 75%;
    background: var(--color-info);
}

.password-strength[data-strength="strong"] .password-strength-bar {
    width: 100%;
    background: var(--color-success);
}

/* ==========================================================================
   Character Counter
   ========================================================================== */

.char-counter {
    font-size: var(--font-size-xs);
    color: var(--color-gray-500);
    text-align: right;
    margin-top: var(--space-1);
    transition: color var(--transition-fast) var(--ease-out);
}

.char-counter.warning {
    color: var(--color-warning);
}

.char-counter.error {
    color: var(--color-danger);
    font-weight: var(--font-weight-medium);
}

/* ==========================================================================
   Required Field Indicator
   ========================================================================== */

.required-indicator {
    color: var(--color-danger);
    margin-left: var(--space-1);
}

/* Pulse animation for required empty fields on submit attempt */
@keyframes required-pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.4;
    }
}

.required-highlight .required-indicator {
    animation: required-pulse var(--transition-slow) var(--ease-in-out) 3;
}

/* ==========================================================================
   Submit Button States
   ========================================================================== */

/* Button loading state */
.btn-loading {
    position: relative;
    color: transparent !important;
    pointer-events: none;
}

.btn-loading::after {
    content: '';
    position: absolute;
    width: var(--space-5);
    height: var(--space-5);
    top: 50%;
    left: 50%;
    margin: calc(var(--space-5) / -2) 0 0 calc(var(--space-5) / -2);
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: var(--radius-full);
    animation: btn-spin 0.8s linear infinite;
}

@keyframes btn-spin {
    to { transform: rotate(360deg); }
}

/* Button success state */
.btn-success-state {
    background: var(--color-success) !important;
    border-color: var(--color-success) !important;
}

/* Button error state */
.btn-error-state {
    background: var(--color-danger) !important;
    border-color: var(--color-danger) !important;
    animation: form-shake-subtle 0.4s var(--ease-out);
}

/* ==========================================================================
   Inline Validation (Real-time)
   ========================================================================== */

/* Typing indicator */
.form-typing {
    border-color: var(--color-info) !important;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
}

/* Validating state */
.form-validating {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Ccircle cx='12' cy='12' r='10' stroke-dasharray='32' stroke-dashoffset='32'%3E%3Canimate attributeName='stroke-dashoffset' dur='1s' values='32;0;32' repeatCount='indefinite'/%3E%3C/circle%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right var(--space-3) center;
    background-size: var(--space-4);
    padding-right: var(--space-10) !important;
}

/* ==========================================================================
   Dark Mode
   ========================================================================== */

[data-theme="dark"] .is-invalid,
[data-theme="dark"] .form-error,
[data-theme="dark"] .has-error input,
[data-theme="dark"] [data-validation="error"] {
    border-color: #f87171 !important;
    box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.2) !important;
}

[data-theme="dark"] .is-valid,
[data-theme="dark"] .form-success,
[data-theme="dark"] .has-success input,
[data-theme="dark"] [data-validation="success"] {
    border-color: var(--color-green-400) !important;
    box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.2) !important;
}

[data-theme="dark"] .form-error-message,
[data-theme="dark"] .invalid-feedback,
[data-theme="dark"] .error-message {
    color: #f87171;
}

[data-theme="dark"] .form-success-message,
[data-theme="dark"] .valid-feedback,
[data-theme="dark"] .success-message {
    color: var(--color-green-400);
}

[data-theme="dark"] .form-group.has-error label {
    color: #f87171;
}

[data-theme="dark"] .form-group.has-success label {
    color: var(--color-green-400);
}

[data-theme="dark"] .password-strength {
    background: var(--color-gray-200);
}

[data-theme="dark"] .char-counter {
    color: var(--color-gray-400);
}

[data-theme="dark"] .form-validation-icon--success {
    color: var(--color-green-400);
}

[data-theme="dark"] .form-validation-icon--error {
    color: #f87171;
}

/* ==========================================================================
   Reduced Motion
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
    .form-shake,
    .form-shake-subtle,
    .is-invalid:focus,
    .form-error:focus,
    .form-group.has-error,
    .btn-error-state {
        animation: none;
    }

    .form-error-message,
    .invalid-feedback,
    .form-success-message,
    .valid-feedback {
        animation: none;
    }

    .is-valid ~ .form-validation-icon--success svg {
        animation: none;
        stroke-dashoffset: 0;
        opacity: 1;
    }

    .form-success-pulse {
        animation: none;
    }
}

/* ==========================================================================
   Accessibility - High Contrast
   ========================================================================== */

@media (forced-colors: active) {
    .is-invalid,
    .form-error {
        border: 2px solid LinkText;
    }

    .is-valid,
    .form-success {
        border: 2px solid LinkText;
    }
}
